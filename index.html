<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫íÂãïÂåñÂ≠∏ÊºîÁ§∫‰∏≠ÂøÉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Basic scrollbar styling for demo content */
        #demoContent::-webkit-scrollbar {
            width: 8px;
        }
        #demoContent::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        #demoContent::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        #demoContent::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Ensure canvas elements are responsive within their containers if not intrinsically sized by JS */
        canvas {
            max-width: 100%;
            height: auto !important; /* Override fixed heights if necessary, let JS control if possible */
        }
        /* Styles for the custom alert */
        #customAlertModal {
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-700 text-white min-h-screen flex flex-col items-center justify-center p-4 selection:bg-sky-500 selection:text-white">

    <div id="homeScreen" class="text-center w-full max-w-4xl mx-auto">
        <header class="mb-12">
            <h1 class="text-5xl md:text-6xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-sky-400 to-cyan-300 py-2">
                ÂåñÂ≠∏ÊºîÁ§∫‰∏≠ÂøÉ
            </h1>
            <p class="text-slate-300 text-lg mt-4">Êé¢Á¥¢ÊúâË∂£ÁöÑ‰∫íÂãïÂåñÂ≠∏ÊºîÁ§∫ÔºÅ</p>
        </header>
        <main id="demoCardsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6 md:gap-8">
            </main>
    </div>

    <div id="demoView" class="hidden w-full max-w-6xl mx-auto bg-slate-800 p-4 sm:p-6 md:p-8 rounded-xl shadow-2xl flex flex-col">
        <header class="flex justify-between items-center mb-6">
            <h2 id="demoTitle" class="text-3xl md:text-4xl font-bold text-sky-300"></h2>
            <button id="backButton" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold px-5 py-2.5 rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-opacity-75">
                ËøîÂõûÈ¶ñÈ†Å
            </button>
        </header>
        <div id="demoContentWrapper" class="flex-grow bg-slate-100 text-gray-800 p-4 sm:p-6 rounded-lg shadow-inner overflow-hidden">
             <div id="demoContent" class="h-[65vh] sm:h-[70vh] overflow-auto">
                </div>
        </div>
    </div>

    <div id="customAlertModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md text-gray-800 transform transition-all scale-95 opacity-0" id="customAlertBox">
            <h3 id="customAlertTitle" class="text-xl font-semibold mb-4 text-sky-700">Ë®äÊÅØ</h3>
            <p id="customAlertMessage" class="mb-6 text-slate-700"></p>
            <div class="text-right">
                <button id="customAlertOkButton" class="bg-sky-500 hover:bg-sky-600 text-white font-medium px-6 py-2 rounded-md shadow-md transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-sky-400">
                    Á¢∫ÂÆö
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- Custom Alert Functionality ---
        const customAlertModal = document.getElementById('customAlertModal');
        const customAlertBox = document.getElementById('customAlertBox');
        const customAlertMessageEl = document.getElementById('customAlertMessage');
        const customAlertTitleEl = document.getElementById('customAlertTitle');
        const customAlertOkButton = document.getElementById('customAlertOkButton');

        function showCustomAlert(message, title = 'Ë®äÊÅØ') {
            customAlertMessageEl.textContent = message;
            customAlertTitleEl.textContent = title;
            customAlertModal.style.display = 'flex';
            setTimeout(() => { // For transition effect
                customAlertBox.style.transform = 'scale(1)';
                customAlertBox.style.opacity = '1';
            }, 50);


            // Handle OK button click
            customAlertOkButton.onclick = () => {
                customAlertBox.style.transform = 'scale(0.95)';
                customAlertBox.style.opacity = '0';
                setTimeout(() => {
                    customAlertModal.style.display = 'none';
                }, 300);
            };
            
            // Close on escape key
            const closeOnEscape = (e) => {
                if (e.key === 'Escape') {
                    customAlertOkButton.click();
                    document.removeEventListener('keydown', closeOnEscape);
                }
            };
            document.addEventListener('keydown', closeOnEscape);
            
            // Ensure OK button is focused for accessibility
            customAlertOkButton.focus();
        }


        // --- Main Application Script ---
        document.addEventListener('DOMContentLoaded', () => {
            const homeScreen = document.getElementById('homeScreen');
            const demoView = document.getElementById('demoView');
            const demoContentEl = document.getElementById('demoContent');
            const demoTitleEl = document.getElementById('demoTitle');
            const backButton = document.getElementById('backButton');
            const demoCardsContainer = document.getElementById('demoCardsContainer');

            const demos = [
                { id: 'chemical_naming', title: 'ÂåñÂ≠∏ÈÖçÂ∞çÊ∂àÊ∂àÊ®Ç', description: 'Ê∏¨Ë©¶ÊÇ®ÁöÑÂåñÂ≠∏ÂºèËàáÂêçÁ®±ÈÖçÂ∞çÊäÄÂ∑ß„ÄÇ', icon: 'üß©', bgColor: 'bg-emerald-600', hoverColor: 'hover:bg-emerald-700' },
                { id: 'ionic_radius', title: 'Èõ¢Â≠êÂçäÂæëÁöÑËÆäÂåñ', description: 'ËßÄÂØüÊ†∏ÈõªËç∑Êï∏ËàáÈõªÂ≠êÊï∏Â¶Ç‰ΩïÂΩ±ÈüøÈõ¢Â≠êÂçäÂæë„ÄÇ', icon: 'üî¨', bgColor: 'bg-sky-600', hoverColor: 'hover:bg-sky-700' },
                { id: 'solution_animation', title: 'Á®ÄÊøÉÊ∫∂Ê∂≤ÂãïÁï´', description: 'Ë¶ñË¶∫ÂåñÊ∫∂Ê∂≤Á®ÄÈáãËàáÊøÉÁ∏ÆÁöÑÈÅéÁ®ã„ÄÇ', icon: '‚öóÔ∏è', bgColor: 'bg-amber-600', hoverColor: 'hover:bg-amber-700' },
                { id: 'atomic_radius', title: 'ÂéüÂ≠êÂçäÂæëËÆäÂåñ', description: 'Êé¢Á¥¢ÂéüÂ≠êÂçäÂæëÂú®ÂÖÉÁ¥†ÈÄ±ÊúüË°®‰∏≠ÁöÑË∂®Âã¢„ÄÇ', icon: '‚öõÔ∏è', bgColor: 'bg-purple-600', hoverColor: 'hover:bg-purple-700' }
            ];

            // Create demo cards on the home screen
            demos.forEach(demo => {
                const card = document.createElement('div');
                card.className = `p-6 rounded-xl shadow-xl transform transition duration-300 hover:scale-105 cursor-pointer text-left flex flex-col justify-between ${demo.bgColor} ${demo.hoverColor}`;
                card.innerHTML = `
                    <div>
                        <div class="text-4xl mb-3">${demo.icon}</div>
                        <h2 class="text-2xl font-semibold mb-2">${demo.title}</h2>
                        <p class="text-sm text-slate-200">${demo.description}</p>
                    </div>
                    <button class="mt-4 w-full bg-white/20 hover:bg-white/30 text-white font-medium py-2 px-4 rounded-md transition duration-150">
                        ÈñãÂßãÊºîÁ§∫
                    </button>
                `;
                card.addEventListener('click', () => showDemo(demo.id, demo.title));
                demoCardsContainer.appendChild(card);
            });

            function showHomeScreen() {
                homeScreen.classList.remove('hidden');
                homeScreen.classList.add('block'); // Or flex, grid depending on layout
                demoView.classList.add('hidden');
                demoView.classList.remove('flex'); 
                demoContentEl.innerHTML = ''; // Clear previous demo content
                
                const dynamicStyle = document.getElementById('demoSpecificStyle');
                if (dynamicStyle) dynamicStyle.remove();
                const dynamicScript = document.getElementById('demoSpecificScript');
                if (dynamicScript) dynamicScript.remove();
            }

            function showDemo(demoId, demoTitleText) {
                homeScreen.classList.add('hidden');
                homeScreen.classList.remove('block');
                demoView.classList.remove('hidden');
                demoView.classList.add('flex'); // Use flex for demoView layout
                demoTitleEl.textContent = demoTitleText;
                loadDemoContent(demoId);
                // Scroll to top of demo view
                demoView.scrollIntoView({ behavior: 'smooth' });
            }

            backButton.addEventListener('click', showHomeScreen);

            async function loadDemoContent(demoId) {
                let htmlContent = '';
                let cssContent = '';
                let jsContent = '';

                demoContentEl.innerHTML = ''; // Clear previous
                const oldDemoStyle = document.getElementById('demoSpecificStyle');
                if (oldDemoStyle) oldDemoStyle.remove();
                const oldDemoScript = document.getElementById('demoSpecificScript');
                if (oldDemoScript) oldDemoScript.remove();

                // Fetch or define content for each demo
                if (demoId === 'chemical_naming') {
                    htmlContent = getChemicalNamingHTML();
                    cssContent = getChemicalNamingCSS();
                    jsContent = getChemicalNamingJS().replace(/alert\(([^)]+)\)/g, "showCustomAlert($1)");
                } else if (demoId === 'ionic_radius') {
                    htmlContent = getIonicRadiusHTML();
                    cssContent = getIonicRadiusCSS();
                    jsContent = getIonicRadiusJS();
                } else if (demoId === 'solution_animation') {
                    htmlContent = getSolutionAnimationHTML();
                    cssContent = getSolutionAnimationCSS();
                    jsContent = getSolutionAnimationJS();
                } else if (demoId === 'atomic_radius') {
                    htmlContent = getAtomicRadiusHTML();
                    cssContent = getAtomicRadiusCSS();
                    jsContent = getAtomicRadiusJS();
                }

                demoContentEl.innerHTML = htmlContent;

                if (cssContent) {
                    const styleTag = document.createElement('style');
                    styleTag.id = 'demoSpecificStyle';
                    styleTag.textContent = cssContent;
                    document.head.appendChild(styleTag);
                }

                if (jsContent) {
                    // For scripts that rely on Chart.js, ensure it's loaded.
                    if (demoId === 'solution_animation' && typeof Chart === 'undefined') {
                        console.warn('Chart.js not loaded yet for solution_animation. Retrying...');
                        // This case should be handled by Chart.js being preloaded or waiting.
                        // For simplicity, we assume Chart.js is available from the global script tag.
                        // If issues, a more robust loader for Chart.js would be needed.
                    }
                    
                    // Scripts are executed by adding them to the DOM.
                    // We wrap the JS content in a function and call it to ensure it runs in the current scope
                    // and can be re-initialized if needed. This also helps with potential 'use strict' issues.
                    const scriptTag = document.createElement('script');
                    scriptTag.id = 'demoSpecificScript';
                    // IIFE to ensure code runs and variables are scoped
                    scriptTag.textContent = `(() => { ${jsContent} })();`; 
                    document.body.appendChild(scriptTag); // Appending to body ensures DOM is ready
                }
                 // Ensure child elements like canvas resize correctly after content load
                window.dispatchEvent(new Event('resize'));
            }

            // --- Demo Content Functions ---

            function getChemicalNamingHTML() {
                return `
                    <div class_to_be_styled_by_tailwind="bg-gray-100 flex flex-col items-center justify-center p-4 min-h-full text-gray-800">
                        <div id="startScreen" class="fade-in text-center">
                             <h1 class="text-3xl font-bold text-gray-800 mb-6">ÂåñÂ≠∏ÈÖçÂ∞çÊ∂àÊ∂àÊ®Ç</h1>
                            <button id="startButton" class="bg-green-500 text-white px-8 py-4 rounded-lg shadow-md hover:bg-green-600 transition duration-300 text-lg">
                                ÈñãÂßãÈÅäÊà≤
                            </button>
                        </div>

                        <div class="flex flex-col md:flex-row gap-6 items-start mt-6">
                            <div id="grid" class="grid grid-cols-4 gap-3" style="display: none;"></div>
                            <div id="leaderboard" class="bg-white p-5 rounded-lg shadow-md w-full md:w-80 order-first md:order-last" style="display: none;">
                                <h2 class="text-xl font-bold text-gray-800 mb-3">ÊéíË°åÊ¶ú</h2>
                                <ul id="leaderboardList" class="space-y-1.5"></ul>
                                <button id="clearLeaderboard" class="bg-red-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-red-600 transition duration-300 mt-4 w-full">
                                    Ê∏ÖÈô§ÊéíÂêç
                                </button>
                            </div>
                        </div>

                        <p id="message" class="text-lg font-semibold text-gray-700 mt-6"></p>

                        <div id="restartScreen" class="fade-in mt-6" style="display: none;">
                            <button id="restartButton" class="bg-blue-500 text-white px-8 py-4 rounded-lg shadow-md hover:bg-blue-600 transition duration-300 text-lg">
                                ÈáçÊñ∞ÈñãÂßã
                            </button>
                        </div>
                        <p class="text-2xl font-bold text-gray-800 mt-6">ÂàÜÊï∏: <span id="score">0</span></p>
                        <div id="nameInputModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40" style="display: none;">
                            <div class="bg-white p-6 rounded-lg shadow-md w-96">
                                <h2 class="text-xl font-bold text-gray-800 mb-4">Ëº∏ÂÖ•‰Ω†ÁöÑÂêçÁ®±</h2>
                                <input type="text" id="playerName" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4" placeholder="‰Ω†ÁöÑÂêçÁ®±">
                                <button id="confirmName" class="bg-green-500 text-white px-6 py-2 rounded-lg shadow-md hover:bg-green-600 transition duration-300 w-full">
                                    Á¢∫Ë™ç
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            function getChemicalNamingCSS() {
                return `
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    .fade-in {
                        animation: fadeIn 0.5s ease-in-out;
                    }
                    #grid > div { /* Style for game cells */
                        width: 5rem; height: 5rem; /* Adjust size as needed */
                        font-size: 0.9rem; /* Smaller font for fitting text */
                        line-height: 1.2;
                        padding: 0.25rem;
                        overflow-wrap: break-word;
                        word-break: break-all;
                        hyphens: auto;
                    }
                     @media (max-width: 640px) { /* Smaller screens */
                        #grid {
                            gap: 0.5rem; /* Smaller gap */
                        }
                        #grid > div {
                             width: calc( (100% / 4) - 0.5rem ); /* Responsive cell width */
                             height: auto;
                             aspect-ratio: 1 / 1; /* Maintain square shape */
                             font-size: 0.75rem;
                        }
                        #leaderboard { width: 100%; margin-top: 1rem;}
                    }
                `;
            }
            function getChemicalNamingJS() {
                // Content of the script from ÂåñÂ≠∏ÂºèÂëΩÂêç.html, modified for alert
                return `
                    const chemicalPairs = [
                        { name: 'Ê∞ØÂåñÈâÄ', formula: 'KCl' }, { name: '‰∏ÄÊ∞ßÂåñ‰∫åÊ∞Æ', formula: 'N‚ÇÇO' }, { name: 'Ê∞ßÂåñÈêµ', formula: 'Fe‚ÇÇO‚ÇÉ' },
                        { name: '‰∫åÊ∞ßÂåñÁ¢≥', formula: 'CO‚ÇÇ' }, { name: '‰∫åÊ∞ßÂåñÁ°Ö', formula: 'SiO‚ÇÇ' }, { name: 'Á°ùÈÖ∏', formula: 'HNO‚ÇÉ' },
                        { name: 'Á¢≥ÈÖ∏', formula: 'H‚ÇÇCO‚ÇÉ' }, { name: 'Á°´ÈÖ∏', formula: 'H‚ÇÇSO‚ÇÑ' }, { name: 'Á°´ÈÖ∏ÈâÄ', formula: 'K‚ÇÇSO‚ÇÑ' },
                        { name: 'Á¢≥ÈÖ∏ÈéÇ', formula: 'MgCO‚ÇÉ' }, { name: 'Á°ùÈÖ∏Èàâ', formula: 'NaNO‚ÇÉ' }, { name: 'Á¢≥ÈÖ∏Èà£', formula: 'CaCO‚ÇÉ' },
                        { name: '‰∏ÄÊ∞ßÂåñ‰∫åÊ∞´', formula: 'H‚ÇÇO' }, { name: 'ÂõõÊ∞ßÂåñ‰∏âÈêµ', formula: 'Fe‚ÇÉO‚ÇÑ' }, { name: '‰∫îÊ∞ßÂåñ‰∫åÊ∞Æ', formula: 'N‚ÇÇO‚ÇÖ' },
                        { name: '‰∏ÉÊ∞ßÂåñ‰∫åÊ∞Ø', formula: 'Cl‚ÇÇO‚Çá' }, { name: 'Á°´ÈÖ∏Èàâ', formula: 'Na‚ÇÇSO‚ÇÑ' }, { name: 'Á¢≥ÈÖ∏ÈãÅ', formula: 'Al‚ÇÇ(CO‚ÇÉ)‚ÇÉ' },
                        { name: 'Ê∞ßÊ∞£', formula: 'O‚ÇÇ' }, { name: 'Ê∞´Ê∞£', formula: 'H‚ÇÇ' }, { name: 'Ê∞¶Ê∞£', formula: 'He' },
                        { name: 'ÈâÄ', formula: 'K' }, { name: 'Èàâ', formula: 'Na' }, { name: 'Ê∞ñÊ∞£', formula: 'Ne' },
                        { name: 'Á°Ö', formula: 'Si' }, /* Removed duplicate SiO2 */ { name: 'Ê∞ßÂåñÈàâ', formula: 'Na‚ÇÇO' },
                        { name: 'Ê∞ØÂåñÊ∞´', formula: 'HCl' }, { name: 'Á°´ÂåñÈàâ', formula: 'Na‚ÇÇS' }, { name: '‰∫åÊ∞ßÂåñÁ°´', formula: 'SO‚ÇÇ' },
                        { name: '‰∏âÊ∞ßÂåñÁ°´', formula: 'SO‚ÇÉ' }, { name: 'Ê∞ßÂåñÈà£', formula: 'CaO' }, { name: 'Ê∞ßÂåñÈéÇ', formula: 'MgO' },
                        { name: 'Ê∞ßÂåñÈäÖ', formula: 'CuO' }, { name: 'Ê∞ßÂåñÈãÖ', formula: 'ZnO' }, { name: 'Ê∞ØÂåñÈàâ', formula: 'NaCl' },
                        { name: 'Á°ùÈÖ∏ÈéÇ', formula: 'Mg(NO‚ÇÉ)‚ÇÇ' }, { name: 'Á¢≥ÈÖ∏Èàâ', formula: 'Na‚ÇÇCO‚ÇÉ' }, { name: 'Ê∞ØÂåñÈà£', formula: 'CaCl‚ÇÇ' },
                        { name: 'Á°´ÈÖ∏ÈãÅ', formula: 'Al‚ÇÇ(SO‚ÇÑ)‚ÇÉ' }, { name: 'Á£∑ÈÖ∏Èàâ', formula: 'Na‚ÇÉPO‚ÇÑ' }, { name: 'Ê∞ØÂåñÈä®', formula: 'NH‚ÇÑCl' },
                        { name: 'Á°´ÈÖ∏‰∫ûÈêµ', formula: 'FeSO‚ÇÑ' }, { name: 'Á°ùÈÖ∏ÈãÅ', formula: 'Al(NO‚ÇÉ)‚ÇÉ' }, { name: '‰∫åÊ∞ßÂåñÈå≥', formula: 'MnO‚ÇÇ' },
                        { name: 'Ê∞ßÂåñÈâõ', formula: 'PbO' }, { name: 'Ê∞ßÂåñÈäÄ', formula: 'Ag‚ÇÇO' }, { name: 'Ê∞ßÂåñÊ±û', formula: 'HgO' },
                        /* Removed duplicate ZnO */ { name: 'Ê∞ßÂåñ‰∫ûÈäÖ', formula: 'Cu‚ÇÇO' }, { name: 'Ê∞ßÂåñ‰∫ûÈêµ', formula: 'FeO' },
                        { name: 'Ê∞ßÂåñÈãÅ', formula: 'Al‚ÇÇO‚ÇÉ' }, { name: 'Ê∞ØÂåñÈãÅ', formula: 'AlCl‚ÇÉ' }, { name: 'Ê∞ØÂåñÈêµ', formula: 'FeCl‚ÇÉ' },
                        { name: 'Ê∞ØÂåñÈãÖ', formula: 'ZnCl‚ÇÇ' }, { name: 'Ê∞ØÂåñÈäÖ', formula: 'CuCl‚ÇÇ' }, { name: 'Ê∞ØÂåñÈäÄ', formula: 'AgCl' },
                        { name: 'Á°´ÈÖ∏Èà£', formula: 'CaSO‚ÇÑ' }, { name: 'Á°´ÈÖ∏Èêµ', formula: 'Fe‚ÇÇ(SO‚ÇÑ)‚ÇÉ' }, { name: 'Á°´ÈÖ∏ÈãÖ', formula: 'ZnSO‚ÇÑ' },
                        { name: 'Á°ùÈÖ∏ÈâÄ', formula: 'KNO‚ÇÉ' }, { name: 'Á°ùÈÖ∏Èà£', formula: 'Ca(NO‚ÇÉ)‚ÇÇ' }, { name: 'Á°ùÈÖ∏Èêµ', formula: 'Fe(NO‚ÇÉ)‚ÇÉ' },
                        { name: 'Á°ùÈÖ∏ÈäÖ', formula: 'Cu(NO‚ÇÉ)‚ÇÇ' }
                    ];
                    const gridSize = 4; let gameGrid = []; let selectedCells = []; let matchedCells = [];
                    let score = 0; let startTime; let timer; let playerName = '';
                    let leaderboard = JSON.parse(localStorage.getItem('chemistryGameLeaderboard')) || [];

                    const startButton = document.getElementById('startButton');
                    const gridElement = document.getElementById('grid');
                    const leaderboardList = document.getElementById('leaderboardList');
                    const clearLeaderboardButton = document.getElementById('clearLeaderboard');
                    const messageElement = document.getElementById('message');
                    const restartButton = document.getElementById('restartButton');
                    const scoreElement = document.getElementById('score');
                    const nameInputModal = document.getElementById('nameInputModal');
                    const confirmNameButton = document.getElementById('confirmName');
                    const playerNameInput = document.getElementById('playerName');
                    const startScreen = document.getElementById('startScreen');
                    const restartScreen = document.getElementById('restartScreen');
                    const leaderboardElement = document.getElementById('leaderboard');


                    function updateLeaderboard() {
                        if (!leaderboardList) return;
                        leaderboardList.innerHTML = '';
                        leaderboard.sort((a, b) => b.score - a.score);
                        leaderboard.slice(0, 8).forEach((entry, index) => {
                            const li = document.createElement('li');
                            li.className = 'text-gray-700 text-sm p-1 bg-slate-50 rounded';
                            li.textContent = \`\${index + 1}. \${entry.name}: \${entry.score} ÂàÜ\`;
                            leaderboardList.appendChild(li);
                        });
                    }

                    function getRandomPairs() {
                        const shuffledPairs = [...chemicalPairs].sort(() => Math.random() - 0.5);
                        const selectedPairs = shuffledPairs.slice(0, (gridSize * gridSize) / 2);
                        const allItems = [];
                        selectedPairs.forEach(pair => {
                            allItems.push({ type: 'name', value: pair.name, pairId: pair.formula });
                            allItems.push({ type: 'formula', value: pair.formula, pairId: pair.formula });
                        });
                        return allItems.sort(() => Math.random() - 0.5);
                    }

                    function createGrid() {
                        if (!gridElement) return;
                        gridElement.innerHTML = ''; gameGrid = [];
                        const allItems = getRandomPairs();
                        for (let i = 0; i < gridSize * gridSize; i++) {
                            const cell = document.createElement('div');
                            cell.className = 'bg-green-500 text-white flex items-center justify-center text-center font-semibold rounded-lg shadow-md cursor-pointer hover:bg-green-600 transition duration-300';
                            cell.textContent = allItems[i].value;
                            cell.dataset.pairId = allItems[i].pairId;
                            cell.dataset.type = allItems[i].type;
                            cell.addEventListener('click', () => selectCell(cell, i));
                            gridElement.appendChild(cell);
                            gameGrid.push(cell);
                        }
                    }

                    function selectCell(cell, index) {
                        if (matchedCells.includes(index) || selectedCells.length === 2 || cell.classList.contains('bg-orange-500')) return;
                        cell.classList.remove('bg-green-500', 'hover:bg-green-600');
                        cell.classList.add('bg-orange-500', 'hover:bg-orange-600');
                        selectedCells.push({ cell, index, pairId: cell.dataset.pairId, type: cell.dataset.type });
                        if (selectedCells.length === 2) checkMatch();
                    }

                    function checkMatch() {
                        const [cell1, cell2] = selectedCells;
                        if ((cell1.type !== cell2.type) && (cell1.pairId === cell2.pairId)) {
                            cell1.cell.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                            cell2.cell.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                            cell1.cell.classList.add('bg-gray-400', 'text-gray-600', 'cursor-default', 'opacity-70');
                            cell2.cell.classList.add('bg-gray-400', 'text-gray-600', 'cursor-default', 'opacity-70');
                            matchedCells.push(cell1.index, cell2.index);
                            const timeElapsed = (Date.now() - startTime) / 1000;
                            const points = Math.max(100 - Math.floor(timeElapsed), 10);
                            score += points;
                            if (scoreElement) scoreElement.textContent = score;
                            if (matchedCells.length === gridSize * gridSize) {
                                clearInterval(timer);
                                if (messageElement) messageElement.textContent = 'ÊÅ≠ÂñúÔºÅ‰Ω†Ë¥è‰∫ÜÔºÅ';
                                if (restartScreen) restartScreen.style.display = 'block';
                                leaderboard.push({ name: playerName, score });
                                localStorage.setItem('chemistryGameLeaderboard', JSON.stringify(leaderboard));
                                updateLeaderboard();
                            }
                        } else {
                            setTimeout(() => {
                                cell1.cell.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                                cell2.cell.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                                cell1.cell.classList.add('bg-green-500', 'hover:bg-green-600');
                                cell2.cell.classList.add('bg-green-500', 'hover:bg-green-600');
                            }, 500);
                        }
                        selectedCells = [];
                    }

                    function startGame() {
                        if (startScreen) startScreen.style.display = 'none';
                        if (gridElement) gridElement.style.display = 'grid';
                        if (leaderboardElement) leaderboardElement.style.display = 'block';
                        if (restartScreen) restartScreen.style.display = 'none';
                        if (messageElement) messageElement.textContent = '';
                        score = 0;
                        if (scoreElement) scoreElement.textContent = score;
                        matchedCells = []; selectedCells = [];
                        createGrid();
                        startTime = Date.now();
                        if (timer) clearInterval(timer);
                        timer = setInterval(() => {
                            const timeElapsed = (Date.now() - startTime) / 1000;
                            if (messageElement) messageElement.textContent = \`ÊôÇÈñì: \${timeElapsed.toFixed(1)} Áßí\`;
                        }, 100);
                    }
                    
                    if (startButton) {
                        startButton.addEventListener('click', () => {
                            if (nameInputModal) nameInputModal.style.display = 'flex';
                        });
                    }
                    if (confirmNameButton) {
                        confirmNameButton.addEventListener('click', () => {
                            playerName = playerNameInput.value.trim();
                            if (playerName) {
                                if (nameInputModal) nameInputModal.style.display = 'none';
                                startGame();
                            } else {
                                showCustomAlert('Ë´ãËº∏ÂÖ•‰Ω†ÁöÑÂêçÁ®±ÔºÅ');
                            }
                        });
                    }
                    if (restartButton) {
                        restartButton.addEventListener('click', () => {
                             if (nameInputModal) nameInputModal.style.display = 'flex'; // Ask for name again or just restart
                        });
                    }
                    if (clearLeaderboardButton) {
                        clearLeaderboardButton.addEventListener('click', () => {
                            leaderboard = [];
                            localStorage.setItem('chemistryGameLeaderboard', JSON.stringify(leaderboard));
                            updateLeaderboard();
                        });
                    }
                    updateLeaderboard(); // Initial call
                `;
            }

            function getIonicRadiusHTML() {
                return `
                    <div class="p-2 md:p-4 text-gray-800">
                        <h2 class="text-2xl font-bold mb-4 text-center">Èõ¢Â≠êÂçäÂæëËÆäÂåñÊ®°Êì¨</h2>
                        <div class="control-panel bg-slate-200 p-4 rounded-lg shadow mb-4">
                            <div class="mb-3">
                                Ê†∏ÈõªËç∑Êï∏: 
                                <input type="range" id="protons" min="1" max="20" value="1" class="w-2/3 md:w-3/4 align-middle">
                                <span class="param-value ml-2 p-1 bg-white rounded" id="protonsValue">1</span>
                                <button class="explain-btn ml-1 md:ml-3 px-3 py-1.5 bg-sky-500 text-white rounded hover:bg-sky-600 text-sm" onclick="toggleExplanation()">ÂÖ∑È´îÂéüÂõ†</button>
                            </div>
                            <div class="mb-3">
                                ÈõªÂ≠êÂ±§Êï∏: 
                                <input type="range" id="layers" min="1" max="3" value="1" class="w-2/3 md:w-3/4 align-middle">
                                <span class="param-value ml-2 p-1 bg-white rounded" id="layersValue">1</span>
                            </div>
                            <div>
                                Ê†∏Â§ñÈõªÂ≠êÊï∏: 
                                <input type="range" id="electrons" min="1" max="20" value="1" class="w-2/3 md:w-3/4 align-middle">
                                <span class="param-value ml-2 p-1 bg-white rounded" id="electronsValue">1</span>
                            </div>
                        </div>
                        <div id="containerWrapper" class="flex justify-center items-center bg-white rounded-lg shadow p-2" style="min-height: 420px;">
                             <div id="ionicRadiusContainer" style="width: 100%; height: 400px; position: relative; border: 1px solid #ccc; margin: 0 auto;"></div>
                        </div>
                        <div class="explanation bg-sky-50 p-4 rounded-lg border border-sky-200 mt-4" id="explanationText" style="display: none;"></div>
                    </div>
                `;
            }
            function getIonicRadiusCSS() {
                return `
                    .explanation { margin: 20px auto; width: 95%; max-width: 600px; padding: 15px; background: #f0f8ff; border: 1px solid #87CEEB; border-radius: 8px; font-size: 15px; line-height: 1.6; }
                    .nucleus span { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); color: #000; font-weight: bold; font-size: 1.2em; pointer-events: none; text-shadow: 0 0 3px white; }
                    #ionicRadiusContainer { width: 100%; height: 400px; position: relative; border: 1px solid #ccc; margin: 0 auto; background-color: #f8f9fa; }
                    .control-panel div { margin: 10px 0; display: flex; align-items: center; flex-wrap: wrap; }
                    .control-panel input[type=range] { flex-grow: 1; }
                    .nucleus { position: absolute; border-radius: 50%; background: #FFD700; transition: all 0.3s; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
                    .electron-layer { position: absolute; border-radius: 50%; border: 2px solid #4A90E2; transition: all 0.3s; }
                    .electron { position: absolute; width: 8px; height: 8px; background: #4A90E2; border-radius: 50%; transform: translate(-50%, -50%); transition: all 0.3s; box-shadow: 0 0 5px rgba(74,144,226,0.5); }
                    .status { position: absolute; right: 10px; top: 10px; font-weight: bold; font-size: 1.1em; padding: 5px 10px; background-color: rgba(255,255,255,0.8); border-radius: 5px; }
                    .param-value { display: inline-block; width: 30px; text-align: right; margin-left: 5px; }
                `;
            }
            function getIonicRadiusJS() {
                // Content from Èõ¢Â≠êÂçäÂæëÁöÑËÆäÂåñ.html
                return `
                    let explanationVisible = false;
                    const explanationTextEl = document.getElementById('explanationText');
                    
                    window.toggleExplanation = function() { // Make it global for onclick
                        explanationVisible = !explanationVisible;
                        if(explanationVisible) {
                            explanationTextEl.innerHTML = \`
                                <h3 style="margin:0 0 10px 0; color:#2196F3; font-weight: bold;">Èõ¢Â≠êÂçäÂæëËÆäÂåñÂéüÁêÜ</h3>
                                <p style="margin:0 0 8px 0;">Áï∂ÂéüÂ≠êÁç≤ÂæóÈ°çÂ§ñÈõªÂ≠êÂΩ¢Êàê<b style="color:red; font-weight:bold;">Èô∞Èõ¢Â≠ê</b>ÊôÇÔºö<br>
                                ‚û§ Ê†∏Â§ñÈõªÂ≠êÊï∏ÁõÆÂ¢ûÂ§ö<br>
                                ‚û§ ÈõªÂ≠êÈñìÊéíÊñ•ÂäõÂ¢ûÂº∑<br>
                                ‚û§ ÈõªÂ≠êÈõ≤ÂêëÂ§ñÊì¥Âºµ<br>
                                ‚û§ Èõ¢Â≠êÂçäÂæëÂ¢ûÂ§ß</p>
                                <hr style="margin:10px 0; border-top: 1px solid #87CEEB;">
                                <p style="margin:0;">Áï∂ÂéüÂ≠êÂ§±ÂéªÈõªÂ≠êÂΩ¢Êàê<b style="color:blue; font-weight:bold;">ÈôΩÈõ¢Â≠ê</b>ÊôÇÔºö<br>
                                ‚û§ ÈõªÂ≠êÊï∏ÁõÆÊ∏õÂ∞ë<br>
                                ‚û§ ÈõªÂ≠êÈñìÊéíÊñ•ÂäõÊ∏õÂº±<br>
                                ‚û§ ÈõªÂ≠êÈõ≤Êî∂Á∏Æ<br>
                                ‚û§ Èõ¢Â≠êÂçäÂæëÊ∏õÂ∞è</p>
                            \`;
                            explanationTextEl.style.display = 'block';
                        } else {
                            explanationTextEl.innerHTML = '';
                            explanationTextEl.style.display = 'none';
                        }
                    }

                    const container = document.getElementById('ionicRadiusContainer');
                    const protonsSlider = document.getElementById('protons');
                    const layersSlider = document.getElementById('layers');
                    const electronsSlider = document.getElementById('electrons');
                    const protonsValueEl = document.getElementById('protonsValue');
                    const layersValueEl = document.getElementById('layersValue');
                    const electronsValueEl = document.getElementById('electronsValue');

                    function calculateElectronsDist(total, layerCount) {
                        let distribution = [0, 0, 0];
                        const maxValues = [2, 8, 8]; // K, L, M shells
                        let remainingElectrons = total;
                        for(let i=0; i<layerCount; i++) {
                            if (remainingElectrons <= 0) break;
                            const canPlace = Math.min(remainingElectrons, maxValues[i]);
                            distribution[i] = canPlace;
                            remainingElectrons -= canPlace;
                        }
                        // If there are still electrons left but no more layers specified by layerCount,
                        // this implies an invalid state or a need for more layers.
                        // For this simulation, we'll cap it at the specified layers.
                        return distribution;
                    }

                    function updateDisplayValues() {
                        if(protonsValueEl) protonsValueEl.textContent = protonsSlider.value;
                        if(layersValueEl) layersValueEl.textContent = layersSlider.value;
                        if(electronsValueEl) electronsValueEl.textContent = electronsSlider.value;
                    }

                    function updateAtomVisuals() {
                        if (!container) return; // Ensure container exists
                        container.innerHTML = ''; // Clear previous drawing
                        updateDisplayValues();

                        const p = parseInt(protonsSlider.value);
                        const l = parseInt(layersSlider.value);
                        const e = parseInt(electronsSlider.value);
                        
                        const containerWidth = container.offsetWidth;
                        const containerHeight = container.offsetHeight;
                        const centerX = containerWidth / 2;
                        const centerY = containerHeight / 2;

                        const nucleus = document.createElement('div');
                        nucleus.className = 'nucleus';
                        const nucleusBaseSize = 10; // Minimum nucleus size
                        const nucleusSize = Math.min(nucleusBaseSize + p * 2, Math.min(containerWidth, containerHeight) * 0.2); // Responsive nucleus size
                        nucleus.style.width = nucleus.style.height = nucleusSize + 'px';
                        nucleus.style.left = (centerX - nucleusSize/2) + 'px';
                        nucleus.style.top = (centerY - nucleusSize/2) + 'px';
                        
                        const chargeLabel = document.createElement('span');
                        chargeLabel.textContent = p + '+';
                        nucleus.appendChild(chargeLabel);
                        container.appendChild(nucleus);

                        const chargeDiff = e - p; // Net charge (negative for anions, positive for cations)
                        // Radius scaling factor: anions expand, cations contract. More charge diff = more effect.
                        // Base scaling factor. Adjust 0.05 to control sensitivity.
                        const radiusScaleFactor = 1 - (chargeDiff * 0.05 / l); // Normalize by layers to prevent excessive scaling with few layers
                        
                        const electronLayersDistribution = calculateElectronsDist(e, l);
                        
                        let maxRadius = 0;

                        for(let i=0; i<l; i++) {
                            if (electronLayersDistribution[i] === 0 && i < l -1 && electronLayersDistribution[i+1] > 0) continue; // Skip empty inner shells if outer shells have e-
                            if (electronLayersDistribution[i] === 0 && i === l -1 && e > 0) continue; // Skip empty outermost shell if there are electrons

                            const baseLayerRadius = (nucleusSize / 2) + 30 + i * 40; // Base radius for each layer
                            const actualLayerRadius = baseLayerRadius * radiusScaleFactor;
                            maxRadius = Math.max(maxRadius, actualLayerRadius);

                            const layerDiv = document.createElement('div');
                            layerDiv.className = 'electron-layer';
                            layerDiv.style.width = layerDiv.style.height = (actualLayerRadius*2) + 'px';
                            layerDiv.style.left = (centerX - actualLayerRadius) + 'px';
                            layerDiv.style.top = (centerY - actualLayerRadius) + 'px';
                            container.appendChild(layerDiv);

                            const electronsInThisLayer = electronLayersDistribution[i];
                            for(let j=0; j<electronsInThisLayer; j++) {
                                const electronDiv = document.createElement('div');
                                electronDiv.className = 'electron';
                                const angle = (2 * Math.PI * j) / electronsInThisLayer;
                                const xPos = centerX + actualLayerRadius * Math.cos(angle);
                                const yPos = centerY + actualLayerRadius * Math.sin(angle);
                                electronDiv.style.left = xPos + 'px';
                                electronDiv.style.top = yPos + 'px';
                                container.appendChild(electronDiv);
                            }
                        }
                        
                        // Adjust viewbox if atom is too large (simple scaling of container elements might be complex)
                        // This is a basic visual, so we'll cap radius display rather than implement zooming.
                        // The radii are relative to each other.

                        const statusDiv = document.createElement('div');
                        statusDiv.className = 'status';
                        if(e === p) {
                            statusDiv.textContent = 'ÂéüÂ≠ê'; statusDiv.style.color = 'green';
                        } else if(e > p) {
                            statusDiv.textContent = 'Èô∞Èõ¢Â≠ê'; statusDiv.style.color = 'red';
                        } else {
                            statusDiv.textContent = 'ÈôΩÈõ¢Â≠ê'; statusDiv.style.color = 'blue';
                        }
                        container.appendChild(statusDiv);
                    }
                    
                    // Resize observer for the container
                    if (container) {
                        const resizeObserver = new ResizeObserver(entries => {
                            for (let entry of entries) {
                                updateAtomVisuals();
                            }
                        });
                        resizeObserver.observe(container);
                    }


                    if(protonsSlider && layersSlider && electronsSlider) {
                        protonsSlider.oninput = layersSlider.oninput = electronsSlider.oninput = () => {
                            updateDisplayValues();
                            updateAtomVisuals();
                        };
                    }
                    updateAtomVisuals(); // Initial draw
                `;
            }

            function getSolutionAnimationHTML() {
                 return `
                    <div class="text-gray-800 p-1 md:p-4 h-full flex flex-col">
                        <h1 class="text-2xl font-bold mb-4 text-center">Á°´ÈÖ∏Á®ÄÈáãÈÅéÁ®ã</h1>
                        <div class="flex flex-col lg:flex-row gap-4 items-stretch flex-grow min-h-0">
                            <div class="lg:w-1/3 flex flex-col items-center">
                                <div class="beaker bg-blue-100 border-2 border-gray-700 rounded-t-lg w-48 h-64 md:w-56 md:h-80 relative overflow-hidden mx-auto shadow-inner" id="beakerContainer">
                                    </div>
                                <div class="labels flex justify-around w-48 md:w-56 mx-auto mt-2">
                                    <div class="label text-sm"><span class="inline-block w-3 h-3 rounded-full bg-red-500 mr-1"></span>Ê∫∂Ë≥™</div>
                                    <div class="label text-sm"><span class="inline-block w-3 h-3 rounded-full bg-blue-500 mr-1"></span>Ê∫∂Âäë</div>
                                </div>
                                <div class="controls grid grid-cols-2 gap-2 mt-4 w-full max-w-md">
                                    <button class="button bg-orange-500 hover:bg-orange-600 text-white py-2 px-3 rounded-md text-sm" id="addSolute5g">Âä†ÂÖ•Ê∫∂Ë≥™ 5g</button>
                                    <button class="button bg-orange-500 hover:bg-orange-600 text-white py-2 px-3 rounded-md text-sm" id="addSolute10g">Âä†ÂÖ•Ê∫∂Ë≥™ 10g</button>
                                    <button class="button bg-sky-500 hover:bg-sky-600 text-white py-2 px-3 rounded-md text-sm" id="addSolvent5g">Âä†ÂÖ•Ê∫∂Âäë 5g</button>
                                    <button class="button bg-sky-500 hover:bg-sky-600 text-white py-2 px-3 rounded-md text-sm" id="addSolvent10g">Âä†ÂÖ•Ê∫∂Âäë 10g</button>
                                    <button class="button reset col-span-2 bg-red-500 hover:bg-red-600 text-white py-2 px-3 rounded-md text-sm" id="resetSolution">ÈáçÁΩÆ</button>
                                </div>
                            </div>

                            <div class="lg:w-2/3 flex flex-col gap-4 min-h-0">
                                <div class="particle-count bg-slate-200 p-3 rounded-lg shadow text-center" id="particleCountText">
                                    Ê∫∂Ë≥™Á≤íÂ≠êÔºö50 | Ê∫∂ÂäëÁ≤íÂ≠êÔºö2
                                </div>
                                <div class="status bg-slate-200 p-3 rounded-lg shadow text-center" id="statusInfo">
                                    Áï∂ÂâçÊøÉÂ∫¶Ôºö98% | ÁãÄÊÖãÔºöÊú™Á®ÄÈáã
                                </div>
                                <div class="chart-container flex-grow min-h-[150px] bg-white p-2 rounded-lg shadow">
                                    <canvas id="concentrationChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            function getSolutionAnimationCSS() {
                return `
                    .beaker { border-bottom: 5px solid #333; border-radius: 0 0 20px 20px; } /* More beaker like */
                    .particle { position: absolute; width: 6px; height: 6px; border-radius: 50%; transition: all 0.5s ease-out; }
                    .solute { background-color: #ff6666; /* Red */ }
                    .solvent { background-color: #66a3ff; /* Blue */ }
                    .chart-container { position: relative; } /* Ensure canvas resizes correctly */
                `;
            }
            function getSolutionAnimationJS() {
                // Content from Á®ÄÊøÉÊ∫∂Ê∂≤ÂãïÁï´Á§∫ÊÑè.html, adapted for new chart and structure
                return `
                    const beakerEl = document.getElementById('beakerContainer');
                    const addSolute5gBtn = document.getElementById('addSolute5g');
                    const addSolute10gBtn = document.getElementById('addSolute10g');
                    const addSolvent5gBtn = document.getElementById('addSolvent5g');
                    const addSolvent10gBtn = document.getElementById('addSolvent10g');
                    const resetBtn = document.getElementById('resetSolution');
                    const statusTextEl = document.getElementById('statusInfo');
                    const particleCountTextEl = document.getElementById('particleCountText');
                    const concentrationChartCtx = document.getElementById('concentrationChart')?.getContext('2d');

                    let soluteCount = 50; // Initial solute particles
                    let solventCount = 2;  // Initial solvent particles
                    
                    let totalMass = soluteCount + solventCount; // Assuming 1 particle = 1g for simplicity in concentration calc
                    let operations = 0; // To track operations for chart labels

                    const chartData = {
                        labels: [], // X-axis: Operation number
                        datasets: [{
                            label: 'Ê∫∂Ê∂≤ÊøÉÂ∫¶ (%)',
                            data: [], // Y-axis: Concentration
                            borderColor: '#4CAF50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            fill: true,
                            tension: 0.1
                        }]
                    };
                    let concentrationChart;

                    if (concentrationChartCtx) {
                        concentrationChart = new Chart(concentrationChartCtx, {
                            type: 'line',
                            data: chartData,
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    x: { title: { display: true, text: 'Êìç‰ΩúÊ¨°Êï∏' } },
                                    y: { title: { display: true, text: 'Ê∫∂Ë≥™ÊøÉÂ∫¶ (%)' }, min: 0, max: 100 }
                                },
                                animation: { duration: 500 }
                            }
                        });
                    } else {
                        console.error("Concentration chart canvas context not found!");
                    }
                    
                    function createParticlesInBeaker() {
                        if (!beakerEl) return;
                        beakerEl.innerHTML = ''; // Clear existing particles
                        const beakerHeight = beakerEl.clientHeight;
                        const beakerWidth = beakerEl.clientWidth;

                        for (let i = 0; i < soluteCount; i++) {
                            createParticle('solute', beakerWidth, beakerHeight);
                        }
                        for (let i = 0; i < solventCount; i++) {
                            createParticle('solvent', beakerWidth, beakerHeight);
                        }
                    }

                    function createParticle(type, beakerWidth, beakerHeight, isNew = false) {
                        if (!beakerEl) return;
                        const particle = document.createElement('div');
                        particle.classList.add('particle', type === 'solute' ? 'solute' : 'solvent');
                        // Position randomly within the beaker, more towards bottom initially
                        const bottomAreaHeight = beakerHeight * 0.8; // Particles settle in lower 80%
                        const topOffset = beakerHeight * 0.2;

                        particle.style.left = \`\${Math.random() * (beakerWidth - 8)}px\`;
                        if (isNew) { // New particles fall from top
                            particle.style.top = '-10px'; // Start above beaker
                            setTimeout(() => { // Animate falling
                                particle.style.top = \`\${topOffset + Math.random() * bottomAreaHeight - 8}px\`;
                            }, 50);
                        } else {
                             particle.style.top = \`\${topOffset + Math.random() * bottomAreaHeight - 8}px\`;
                        }
                        beakerEl.appendChild(particle);
                    }


                    function updateSolutionStatus() {
                        totalMass = soluteCount + solventCount;
                        const concentration = totalMass > 0 ? ((soluteCount / totalMass) * 100) : 0;
                        
                        if (statusTextEl) statusTextEl.textContent = \`Áï∂ÂâçÊøÉÂ∫¶Ôºö\${concentration.toFixed(1)}% | ÁãÄÊÖãÔºö\${solventCount > 2 ? (soluteCount / totalMass > 0.5 ? 'ËºÉÊøÉ' : 'ËºÉÁ®Ä') : 'ÂàùÂßãÈ´òÊøÉÂ∫¶'}\`;
                        if (particleCountTextEl) particleCountTextEl.textContent = \`Ê∫∂Ë≥™Á≤íÂ≠êÔºö\${soluteCount} | Ê∫∂ÂäëÁ≤íÂ≠êÔºö\${solventCount}\`;

                        if (concentrationChart) {
                            operations++;
                            chartData.labels.push(operations.toString());
                            chartData.datasets[0].data.push(concentration.toFixed(1));
                            // Limit history to e.g. 20 points
                            if (chartData.labels.length > 20) {
                                chartData.labels.shift();
                                chartData.datasets[0].data.shift();
                            }
                            concentrationChart.update();
                        }
                    }

                    function addMaterial(type, amount) {
                        const beakerWidth = beakerEl.clientWidth;
                        const beakerHeight = beakerEl.clientHeight;
                        for (let i = 0; i < amount; i++) {
                            createParticle(type, beakerWidth, beakerHeight, true); // true for new particle animation
                        }
                        if (type === 'solute') {
                            soluteCount += amount;
                        } else {
                            solventCount += amount;
                        }
                        updateSolutionStatus();
                    }
                    
                    if (addSolute5gBtn) addSolute5gBtn.addEventListener('click', () => addMaterial('solute', 5));
                    if (addSolute10gBtn) addSolute10gBtn.addEventListener('click', () => addMaterial('solute', 10));
                    if (addSolvent5gBtn) addSolvent5gBtn.addEventListener('click', () => addMaterial('solvent', 5));
                    if (addSolvent10gBtn) addSolvent10gBtn.addEventListener('click', () => addMaterial('solvent', 10));

                    if (resetBtn) {
                        resetBtn.addEventListener('click', () => {
                            soluteCount = 50; solventCount = 2; operations = 0;
                            if (chartData.labels) chartData.labels = [];
                            if (chartData.datasets[0] && chartData.datasets[0].data) chartData.datasets[0].data = [];
                            if (concentrationChart) concentrationChart.update();
                            createParticlesInBeaker();
                            updateSolutionStatus();
                        });
                    }
                    
                    // Initial setup
                    createParticlesInBeaker();
                    updateSolutionStatus();
                     // Redraw particles if beaker resizes
                    if (beakerEl) {
                        new ResizeObserver(createParticlesInBeaker).observe(beakerEl);
                    }
                `;
            }


            function getAtomicRadiusHTML() {
                return `
                    <div class="p-2 md:p-4 text-gray-800 h-full flex flex-col">
                        <h2 class="text-2xl font-bold mb-4 text-center">ÂéüÂ≠êÂçäÂæëËÆäÂåñË∂®Âã¢</h2>
                        <div class="controls flex flex-wrap justify-center gap-2 mb-4">
                            <button class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600" onclick="toggleAtomMode('group')" id="groupBtn">‰∏ªÊóèËÆäÂåñÊ®°Âºè</button>
                            <button class="px-3 py-1.5 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 text-sm" onclick="handleAtomReason('group')" id="groupReasonBtn">ÂéüÂõ†</button>
                            <button class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600" onclick="toggleAtomMode('period')" id="periodBtn">ÈÄ±ÊúüËÆäÂåñÊ®°Âºè</button>
                            <button class="px-3 py-1.5 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 text-sm" onclick="handleAtomReason('period')" id="periodReasonBtn">ÂéüÂõ†</button>
                            </div>
                        
                        <div class="param-controls bg-slate-200 p-3 rounded-lg shadow mb-4">
                            <label class="block mb-2">ÈõªÂ≠êÂ±§Êï∏ (n):
                                <select id="atomLayers" onchange="updateAtomParams()" class="ml-2 p-1.5 border border-gray-300 rounded-md w-full md:w-auto">
                                    <option value="1">1</option> <option value="2" selected>2</option> <option value="3">3</option>
                                    <option value="4">4</option> <option value="5">5</option>
                                </select>
                            </label>
                            <label class="block">ÊúÄÂ§ñÂ±§ÈõªÂ≠êÊï∏:
                                <select id="atomElectrons" onchange="updateAtomParams()" class="ml-2 p-1.5 border border-gray-300 rounded-md w-full md:w-auto">
                                    <option value="1">1</option> <option value="2">2</option> <option value="3">3</option>
                                    <option value="4">4</option> <option value="5">5</option> <option value="6">6</option>
                                    <option value="7">7</option> <option value="8">8</option>
                                </select>
                            </label>
                        </div>

                        <div class="flex-grow flex justify-center items-center bg-white rounded-lg shadow p-1" style="min-height: 350px;">
                           <canvas id="atomCanvasEl" width="600" height="400" class="border border-gray-300 bg-gray-50 rounded-md"></canvas>
                        </div>
                        <div id="atomInfo" class="explanation-box bg-indigo-50 p-3 rounded-lg border border-indigo-200 mt-4 text-sm"></div>
                        <div id="atomReason" class="reason-box bg-emerald-50 p-3 rounded-lg border border-emerald-200 mt-3 text-sm" style="display: none;"></div>
                    </div>
                `;
            }
            function getAtomicRadiusCSS() {
                return `
                    #atomCanvasEl { max-width: 100%; height: auto; aspect-ratio: 600 / 400; }
                    .controls button.active-mode { filter: brightness(1.2); transform: scale(1.05); }
                    .reason-box.period-reason { border-color: #1565c0; background: #e3f2fd; }
                    .explanation-box, .reason-box { line-height: 1.5; }
                `;
            }
            function getAtomicRadiusJS() {
                // Content from ÂéüÂ≠êÂçäÂæëËÆäÂåñ.html
                return `
                    const atomCanvas = document.getElementById('atomCanvasEl');
                    let atomCtx;
                    if (atomCanvas) atomCtx = atomCanvas.getContext('2d'); else console.error("Atom canvas not found");
                    
                    let currentAtomMode = 'group';
                    let atomAnimationId; // For potential animation

                    const atomSimParams = {
                        layers: 2,
                        electrons: 1,
                        baseRadius: 50, // Smaller base for better fit
                        layerSpacing: 35, // Spacing between layers
                        periodShrink: { base: 1.0, perElectron: 0.035 }, // Adjusted for visibility
                        nucleus: { base: 12, layerFactor: 1.5, electronFactor: 0.3 }
                    };

                    const atomLayerColors = ['#2E86C1', '#28B463', '#8E44AD', '#CB4335', '#FF9800'];

                    function calculatePeriodRadii() {
                        const effectiveElectrons = Math.max(1, atomSimParams.electrons); // Avoid zero or negative
                        const shrinkFactor = atomSimParams.periodShrink.base - (effectiveElectrons - 1) * atomSimParams.periodShrink.perElectron;
                        let radii = [];
                        for(let i=0; i < atomSimParams.layers; i++) {
                            radii.push((atomSimParams.baseRadius + i * atomSimParams.layerSpacing) * shrinkFactor);
                        }
                        return radii.map(r => Math.max(5, r)); // Ensure radius is not too small
                    }

                    function calculateNucleusSize() {
                        return atomSimParams.nucleus.base + 
                              (atomSimParams.layers - 1) * atomSimParams.nucleus.layerFactor + 
                              (atomSimParams.electrons - 1) * atomSimParams.nucleus.electronFactor;
                    }

                    window.handleAtomReason = function(mode) { // Global for onclick
                        const reasonDiv = document.getElementById('atomReason');
                        if (!reasonDiv) return;
                        if (currentAtomMode === mode) {
                            let reasonText = '';
                            if (mode === 'group') {
                                reasonText = \`<b>Âêå‰∏ªÊóèÂÖÉÁ¥†ÔºàÊúÄÂ§ñÂ±§ÈõªÂ≠êÊï∏‰∏çËÆäÔºâ:</b><br>
                                            1. <b>ÈõªÂ≠êÂ±§Êï∏Â¢ûÂä†Ôºö</b>ÊØèÂ¢ûÂä†‰∏ÄÂÄãÈõªÂ≠êÂ±§ÔºåÂéüÂ≠êÈ´îÁ©çÈ°ØËëóÂ¢ûÂ§ß„ÄÇ<br>
                                            2. <b>ÈÅÆËîΩÊïàÊáâÔºö</b>ÂÖßÂ±§ÈõªÂ≠êÂ∞çÂ§ñÂ±§ÈõªÂ≠êÁöÑÊéíÊñ•ÈÉ®ÂàÜÊäµÊ∂à‰∫ÜÊ†∏ÈõªËç∑ÁöÑÂê∏ÂºïÂäõ„ÄÇ<br>
                                            3. <b>‰∏ªË¶ÅÂõ†Á¥†Ôºö</b>ÈõªÂ≠êÂ±§Êï∏ÊòØÊ±∫ÂÆöÂçäÂæëÁöÑ‰∏ªË¶ÅÂõ†Á¥†„ÄÇ<br>
                                            <b>ÁµêË´ñÔºö</b>Âêå‰∏Ä‰∏ªÊóèÂæû‰∏äÂà∞‰∏ãÔºåÈõªÂ≠êÂ±§Êï∏Â¢ûÂ§öÔºåÂéüÂ≠êÂçäÂæëÂ¢ûÂ§ß„ÄÇ\`;
                                reasonDiv.className = 'reason-box bg-emerald-50 p-3 rounded-lg border border-emerald-200 mt-3 text-sm';
                            } else {
                                reasonText = \`<b>ÂêåÈÄ±ÊúüÂÖÉÁ¥†ÔºàÈõªÂ≠êÂ±§Êï∏‰∏çËÆäÔºâ:</b><br>
                                            1. <b>Ê†∏ÈõªËç∑Êï∏Â¢ûÂä†Ôºö</b>ÂæûÂ∑¶Âà∞Âè≥ÔºåÂéüÂ≠êÊ†∏‰∏≠ÁöÑË≥™Â≠êÊï∏Â¢ûÂä†ÔºåÊ†∏ÈõªËç∑Â¢ûÂº∑„ÄÇ<br>
                                            2. <b>ÊúâÊïàÊ†∏ÈõªËç∑Â¢ûÂä†Ôºö</b>ÊúÄÂ§ñÂ±§ÈõªÂ≠êÂèóÂà∞ÁöÑÊ∑®Âê∏ÂºïÂäõÂ¢ûÂ§ß„ÄÇ<br>
                                            3. <b>ÈõªÂ≠êÈõ≤Êî∂Á∏ÆÔºö</b>ÂéüÂ≠êÊ†∏Â∞çÂ§ñÂ±§ÈõªÂ≠êÁöÑÂê∏ÂºïÂäõÂ¢ûÂº∑ÔºåÂ∞éËá¥ÈõªÂ≠êÈõ≤ÂêëÂéüÂ≠êÊ†∏Êî∂Á∏Æ„ÄÇ<br>
                                            <b>ÁµêË´ñÔºö</b>Âêå‰∏ÄÈÄ±ÊúüÂæûÂ∑¶Âà∞Âè≥ÔºåÊ†∏ÈõªËç∑Êï∏Â¢ûÂ§öÔºåÂéüÂ≠êÂçäÂæëÊ∏õÂ∞èÔºàÁ®ÄÊúâÊ∞£È´îÈô§Â§ñÔºâ„ÄÇ\`;
                                reasonDiv.className = 'reason-box period-reason bg-sky-50 p-3 rounded-lg border border-sky-200 mt-3 text-sm';
                            }
                            reasonDiv.innerHTML = reasonText;
                            reasonDiv.style.display = 'block';
                        }
                    }

                    window.toggleAtomMode = function(mode) { // Global for onclick
                        currentAtomMode = mode;
                        document.getElementById('groupBtn')?.classList.toggle('active-mode', mode === 'group');
                        document.getElementById('periodBtn')?.classList.toggle('active-mode', mode === 'period');
                        const reasonDiv = document.getElementById('atomReason');
                        if(reasonDiv) reasonDiv.style.display = 'none';
                        drawAtomFigure();
                    }

                    function drawAtomFigure() {
                        if (!atomCtx || !atomCanvas) return;
                        const centerX = atomCanvas.width / 2;
                        const centerY = atomCanvas.height / 2;
                        atomCtx.clearRect(0, 0, atomCanvas.width, atomCanvas.height);
                        
                        const nucleusRadius = Math.max(5, calculateNucleusSize());
                        let layerRadii = [];
                        let finalAtomRadius = 0;

                        if (currentAtomMode === 'period') {
                            layerRadii = calculatePeriodRadii();
                        } else { // group mode
                            for(let i=0; i < atomSimParams.layers; i++) {
                                layerRadii.push(atomSimParams.baseRadius + i * atomSimParams.layerSpacing);
                            }
                        }
                        finalAtomRadius = layerRadii.length > 0 ? layerRadii[layerRadii.length - 1] : nucleusRadius;
                        
                        // Scale drawing if too large for canvas
                        const maxPossibleRadius = Math.min(centerX, centerY) - 10; // 10px padding
                        let scaleFactor = 1;
                        if (finalAtomRadius > maxPossibleRadius) {
                            scaleFactor = maxPossibleRadius / finalAtomRadius;
                        }
                        
                        const scaledNucleusRadius = nucleusRadius * scaleFactor;
                        const scaledLayerRadii = layerRadii.map(r => r * scaleFactor);
                        const scaledFinalAtomRadius = finalAtomRadius * scaleFactor;


                        // Draw Nucleus
                        const gradient = atomCtx.createRadialGradient(centerX, centerY, scaledNucleusRadius/3, centerX, centerY, scaledNucleusRadius);
                        gradient.addColorStop(0, '#E74C3C'); gradient.addColorStop(1, '#C0392B');
                        atomCtx.fillStyle = gradient; atomCtx.beginPath();
                        atomCtx.arc(centerX, centerY, scaledNucleusRadius, 0, Math.PI * 2); atomCtx.fill();

                        // Draw Electron Layers
                        scaledLayerRadii.forEach((radius, i) => {
                            atomCtx.strokeStyle = atomLayerColors[i % atomLayerColors.length];
                            atomCtx.lineWidth = 1.5; atomCtx.beginPath();
                            atomCtx.arc(centerX, centerY, radius, 0, Math.PI * 2); atomCtx.stroke();
                            
                            atomCtx.fillStyle = atomLayerColors[i % atomLayerColors.length];
                            atomCtx.font = \`\${10 * scaleFactor}px Arial\`;
                            atomCtx.fillText(\`n=\${i+1}\`, centerX + radius + (5 * scaleFactor), centerY + (5*scaleFactor) );
                        });

                        // Draw Electrons on the outermost layer shown
                        if (scaledLayerRadii.length > 0) {
                            const outerRadiusForElectrons = scaledLayerRadii[scaledLayerRadii.length - 1];
                            atomCtx.fillStyle = '#1A237E'; // Dark blue for electrons
                            const numElectronsToShow = currentAtomMode === 'period' ? atomSimParams.electrons : Math.min(atomSimParams.electrons, 8); // Cap at 8 for group visualization simplicity
                            const angleStep = (Math.PI * 2) / numElectronsToShow;

                            for (let i = 0; i < numElectronsToShow; i++) {
                                const angle = angleStep * i;
                                const x = centerX + Math.cos(angle) * outerRadiusForElectrons;
                                const y = centerY + Math.sin(angle) * outerRadiusForElectrons;
                                atomCtx.beginPath();
                                atomCtx.arc(x, y, 4 * scaleFactor, 0, Math.PI * 2); // Electron size
                                atomCtx.fill();
                            }
                        }
                        
                        // Draw radius line
                        atomCtx.setLineDash([3 * scaleFactor, 3 * scaleFactor]);
                        atomCtx.strokeStyle = '#2C3E50'; atomCtx.lineWidth = 1;
                        atomCtx.beginPath(); atomCtx.moveTo(centerX, centerY);
                        atomCtx.lineTo(centerX + scaledFinalAtomRadius, centerY); atomCtx.stroke();
                        atomCtx.setLineDash([]); // Reset line dash

                        updateAtomInfo(finalAtomRadius, nucleusRadius); // Report unscaled radius for consistency
                    }

                    function updateAtomInfo(atomR, nucleusR) {
                        const infoEl = document.getElementById('atomInfo');
                        if (!infoEl) return;
                        let infoText = currentAtomMode === 'group' ?
                            \`<b>Âêå‰∏ªÊóèÊ®°Âºè</b> (ÊúÄÂ§ñÂ±§ÈõªÂ≠êÊï∏: \${atomSimParams.electrons})<br>
                             ÈõªÂ≠êÂ±§Êï∏ (n): \${atomSimParams.layers}<br>
                             ‰º∞ÁÆóÂéüÂ≠êÂçäÂæë: \${atomR.toFixed(1)} Áõ∏Â∞çÂñÆ‰Ωç<br>
                             ‰º∞ÁÆóÊ†∏ÂçäÂæë: \${nucleusR.toFixed(1)} Áõ∏Â∞çÂñÆ‰Ωç\` :
                            \`<b>ÂêåÈÄ±ÊúüÊ®°Âºè</b> (ÈõªÂ≠êÂ±§Êï∏ n: \${atomSimParams.layers})<br>
                             ÊúÄÂ§ñÂ±§ÈõªÂ≠êÊï∏: \${atomSimParams.electrons}<br>
                             ‰º∞ÁÆóÂéüÂ≠êÂçäÂæë: \${atomR.toFixed(1)} Áõ∏Â∞çÂñÆ‰Ωç<br>
                             ‰º∞ÁÆóÊ†∏ÂçäÂæë: \${nucleusR.toFixed(1)} Áõ∏Â∞çÂñÆ‰Ωç\`;
                        infoEl.innerHTML = infoText;
                    }

                    window.updateAtomParams = function() { // Global for onchange
                        const layersSelect = document.getElementById('atomLayers');
                        const electronsSelect = document.getElementById('atomElectrons');
                        if (layersSelect) atomSimParams.layers = parseInt(layersSelect.value);
                        if (electronsSelect) atomSimParams.electrons = parseInt(electronsSelect.value);
                        
                        // In period mode, if layers change, electrons might need adjustment (e.g. layer 1 max 2 electrons)
                        // For simplicity, this demo doesn't strictly enforce electron shell capacities beyond the visual.
                        // The user controls these values to observe trends.
                        
                        drawAtomFigure();
                    }
                    
                    // Initial setup for atom demo
                    if (atomCanvas) { // Ensure canvas exists before trying to draw
                         // Resize observer for the canvas parent to make canvas responsive
                        const canvasContainer = atomCanvas.parentElement;
                        if (canvasContainer) {
                            const resizeObserver = new ResizeObserver(entries => {
                                for (let entry of entries) {
                                    const { width, height } = entry.contentRect;
                                    // Maintain aspect ratio 1.5 (600/400)
                                    const newCanvasWidth = Math.min(width, height * 1.5);
                                    atomCanvas.width = newCanvasWidth - 10; // Small padding
                                    atomCanvas.height = newCanvasWidth / 1.5;
                                    drawAtomFigure();
                                }
                            });
                            resizeObserver.observe(canvasContainer);
                        }
                        toggleAtomMode('group'); // Default mode
                        updateAtomParams(); // Initial draw with default select values
                    }
                `;
            }


            showHomeScreen(); // Initialize to show home screen first
        });
    </script>
</body>
</html>
