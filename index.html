<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ–å­¸å¥‡å¢ƒï¼šäº’å‹•éŠæˆ²æ¨‚åœ’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cp-bg-dark: #0A0A1A;
            --cp-bg-panel: #101028; 
            --cp-bg-panel-translucent: rgba(16, 16, 40, 0.85); 
            --cp-text-primary: #E0E0E0;
            --cp-text-neon-cyan: #00FFFF;
            --cp-text-neon-magenta: #FF00FF;
            --cp-text-neon-lime: #7FFF00;
            --cp-accent-cyan: #00FFFF;
            --cp-accent-magenta: #FF00FF;
            --cp-accent-blue: #4D4DFF;
            --cp-accent-green: #39FF14; 
            --cp-border-neon: rgba(0, 255, 255, 0.7);
            --cp-font-primary: 'Noto Sans TC', 'Inter', sans-serif;
            --cp-font-display: 'Orbitron', 'Noto Sans TC', sans-serif;
        }

        body {
            font-family: var(--cp-font-primary); margin: 0;
            background-color: var(--cp-bg-dark); color: var(--cp-text-primary);
        }

        #homepage {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #0d1b2a 0%, #1b263b 25%, #0f0c29 75%, #0a043c 100%);
            color: var(--cp-text-primary); padding: 20px; text-align: center; position: relative; overflow: hidden;
        }
        #homepage::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 1;
            background: repeating-linear-gradient(transparent, transparent 2px, rgba(0, 255, 255, 0.03) 3px, rgba(0, 255, 255, 0.03) 4px);
            animation: scanlines 20s linear infinite;
        }
        @keyframes scanlines { 0% { background-position: 0 0; } 100% { background-position: 0 100px; } }

        .homepage-title { /* Reduced glow effect */
            font-family: var(--cp-font-display); font-size: clamp(2.5rem, 8vw, 5rem); font-weight: 700;
            color: var(--cp-text-neon-cyan);
            text-shadow: 0 0 8px var(--cp-text-neon-cyan), 0 0 15px var(--cp-text-neon-cyan), 0 0 25px var(--cp-accent-magenta); /* Adjusted glow */
            margin-bottom: 1rem; letter-spacing: 2px; z-index: 2;
        }
        .homepage-subtitle {
            font-size: clamp(1rem, 3vw, 1.5rem); color: var(--cp-text-primary); margin-bottom: 2.5rem;
            max-width: 600px; line-height: 1.6; text-shadow: 0 0 3px var(--cp-accent-magenta); z-index: 2;
        }
        .enter-button {
            font-family: var(--cp-font-display);
            background: linear-gradient(45deg, var(--cp-accent-magenta), var(--cp-accent-cyan));
            color: var(--cp-bg-dark); padding: 1rem 2.5rem; font-size: clamp(1.2rem, 4vw, 1.8rem);
            font-weight: bold; border: none; border-radius: 50px; cursor: pointer; transition: all 0.3s ease;
            box-shadow: 0 0 15px var(--cp-accent-cyan), 0 0 25px var(--cp-accent-magenta), inset 0 0 10px rgba(255,255,255,0.3);
            text-transform: uppercase; letter-spacing: 1px; z-index: 2;
        }
        .enter-button:hover {
            transform: scale(1.05) translateY(-3px);
            box-shadow: 0 0 25px var(--cp-accent-cyan), 0 0 40px var(--cp-accent-magenta), 0 0 60px var(--cp-accent-magenta), inset 0 0 15px rgba(255,255,255,0.5);
        }
        .enter-button:active { transform: scale(0.98) translateY(0px); }

        #main-app-area {
            display: none; flex-direction: column; min-height: 100vh;
            background-color: var(--cp-bg-dark); 
        }
        #main-app-area header {
            background-color: var(--cp-bg-panel); 
            color: var(--cp-text-neon-cyan);
            padding: 1rem; box-shadow: 0 2px 15px rgba(0, 255, 255, 0.3);
            border-bottom: 1px solid var(--cp-border-neon);
        }
        #main-app-area header h1 {
            font-family: var(--cp-font-display);
            text-shadow: 0 0 5px var(--cp-text-neon-cyan);
        }

        #main-app-area nav {
            background-color: var(--cp-bg-panel); padding: 0.75rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid var(--cp-border-neon);
        }
        .nav-button {
            font-family: var(--cp-font-display); padding: 0.6rem 1.2rem; border-radius: 4px; font-weight: 500;
            transition: all 0.3s ease; cursor: pointer;
            background-color: transparent; color: var(--cp-text-neon-cyan);
            border: 1px solid var(--cp-text-neon-cyan); text-shadow: 0 0 3px var(--cp-text-neon-cyan);
        }
        .nav-button:hover {
            background-color: var(--cp-accent-cyan); color: var(--cp-bg-dark);
            box-shadow: 0 0 10px var(--cp-accent-cyan), 0 0 15px var(--cp-accent-cyan); text-shadow: none;
        }
        .active-nav-button {
            background-color: var(--cp-accent-magenta); color: var(--cp-bg-dark);
            border-color: var(--cp-accent-magenta);
            box-shadow: 0 0 10px var(--cp-accent-magenta), 0 0 15px var(--cp-accent-magenta); text-shadow: none;
        }
        .active-nav-button:hover { background-color: var(--cp-accent-magenta); opacity: 0.9; }

        .game-container {
            background-color: var(--cp-bg-panel-translucent); backdrop-filter: blur(5px); 
            padding: 1rem; border-radius: 0.5rem;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2), inset 0 0 10px rgba(0,0,0,0.3);
            margin: 1rem; border: 1px solid var(--cp-border-neon); color: var(--cp-text-primary);
        }
        .game-container h1, .game-container h2 { 
            font-family: var(--cp-font-display); color: var(--cp-text-neon-cyan);
            text-shadow: 0 0 4px var(--cp-text-neon-cyan);
        }
        .game-button {
            font-family: var(--cp-font-display); padding: 0.5rem 1rem; border-radius: 4px;
            transition: all 0.3s ease; cursor: pointer;
            border: 1px solid; text-transform: uppercase; letter-spacing: 1px;
        }
        .game-button-green {
            background-color: transparent; color: var(--cp-accent-green); border-color: var(--cp-accent-green);
            text-shadow: 0 0 3px var(--cp-accent-green);
        }
        .game-button-green:hover {
            background-color: var(--cp-accent-green); color: var(--cp-bg-dark); text-shadow: none;
            box-shadow: 0 0 8px var(--cp-accent-green);
        }
        .game-button-blue {
            background-color: transparent; color: var(--cp-accent-blue); border-color: var(--cp-accent-blue);
            text-shadow: 0 0 3px var(--cp-accent-blue);
        }
        .game-button-blue:hover {
            background-color: var(--cp-accent-blue); color: var(--cp-bg-dark); text-shadow: none;
            box-shadow: 0 0 8px var(--cp-accent-blue);
        }
         .game-button-red {
            background-color: transparent; color: var(--cp-accent-magenta); border-color: var(--cp-accent-magenta);
            text-shadow: 0 0 3px var(--cp-accent-magenta);
        }
        .game-button-red:hover {
            background-color: var(--cp-accent-magenta); color: var(--cp-bg-dark); text-shadow: none;
            box-shadow: 0 0 8px var(--cp-accent-magenta);
        }
        .cyber-input {
            background-color: rgba(0,0,0,0.3); border: 1px solid var(--cp-border-neon);
            color: var(--cp-text-neon-cyan); padding: 0.5rem 0.75rem; border-radius: 4px;
        }
        .cyber-input::placeholder { color: rgba(0, 255, 255, 0.5); }
        .cyber-input:focus {
            outline: none; box-shadow: 0 0 10px var(--cp-accent-cyan); border-color: var(--cp-accent-cyan);
        }

        #main-app-area footer {
            background-color: var(--cp-bg-panel); color: var(--cp-text-neon-cyan);
            padding: 0.75rem; text-align: center; font-size: 0.8rem;
            border-top: 1px solid var(--cp-border-neon); text-shadow: 0 0 2px var(--cp-text-neon-cyan);
        }
        @media (min-width: 768px) { .game-container { padding: 1.5rem; margin: 1.5rem; } }

        /* Game 1: åŒ–å­¸é…å°æ¶ˆæ¶ˆæ¨‚ - Card Styles (No Flip) */
        .score-popup { z-index: 1000; pointer-events: none; }
        .card-containerG1 { 
            width: clamp(70px, 20vw, 120px); /* Slightly larger for better content visibility */
            height: clamp(70px, 20vw, 120px); /* Make them square-ish */
            cursor: pointer;
            display: flex; /* Added for centering content within container if needed */
            align-items: center;
            justify-content: center;
        }
        .cardG1 { /* This is the visible card itself now */
            width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--cp-accent-blue), var(--cp-accent-cyan)); /* Default card bg */
            color: var(--cp-bg-dark);
            border: 2px solid var(--cp-border-neon);
            border-radius: 8px; 
            display: flex; align-items: center; justify-content: center;
            text-align: center; padding: 5px;
            font-size: clamp(0.6rem, 2.2vw, 0.9rem); /* Adjusted font size */
            font-weight: 600;
            transition: background-color 0.3s, opacity 0.3s, border-color 0.3s, box-shadow 0.3s;
        }
        .cardG1.selected { /* Style for selected card */
            background: linear-gradient(135deg, var(--cp-accent-magenta), #ff55ff);
            box-shadow: 0 0 10px var(--cp-accent-magenta);
        }
        .cardG1.matched { /* Style for matched cards */
            opacity: 0.5 !important; 
            border: 3px solid var(--cp-accent-green) !important; 
            box-shadow: 0 0 12px var(--cp-accent-green) !important; 
            pointer-events: none; /* Make unclickable after match */
            background: var(--cp-accent-green) !important; /* Change background to green on match */
            color: var(--cp-bg-dark) !important;
        }
        .shake { animation: shake 0.5s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        #gridG1 { /* Ensure grid displays correctly */
             display: grid;
             grid-template-columns: repeat(4, 1fr); /* Explicitly 4 columns */
             gap: 0.5rem; /* Tailwind's gap-2 */
        }
        @media (min-width: 768px) { /* md breakpoint */
            #gridG1 { gap: 1rem; } /* Tailwind's gap-4 */
        }


        #leaderboardG1 {
            background-color: rgba(0,0,0,0.3); border: 1px solid var(--cp-border-neon);
            color: var(--cp-text-primary);
        }
        #leaderboardG1 h2 { color: var(--cp-text-neon-lime); }
        #leaderboardG1 li { color: var(--cp-text-primary); }
        #nameInputModalG1 .modal-content-areaG1 { 
            background-color: var(--cp-bg-panel-translucent);
            border: 1px solid var(--cp-border-neon); color: var(--cp-text-primary);
        }
        #nameInputModalG1 h2 { color: var(--cp-text-neon-cyan); }
        #scoreG1, #messageG1 { color: var(--cp-text-neon-lime); }


        /* Game 2: åŸå­åŠå¾‘å¤§å°è®ŠåŒ– Specific Styles */
        /* ... (Game 2 CSS remains the same) ... */
        #game2-container canvas { border-color: var(--cp-border-neon); background-color: #080812; }
        #game2-container .controls button, #game2-container .param-controls select {
            font-family: var(--cp-font-display); padding: 0.5rem 1rem; border-radius: 4px;
            transition: all 0.3s ease; cursor: pointer; border: 1px solid;
            background-color: transparent; color: var(--cp-text-neon-cyan); border-color: var(--cp-text-neon-cyan);
        }
        #game2-container .controls button:hover, #game2-container .param-controls select:hover {
            background-color: var(--cp-text-neon-cyan); color: var(--cp-bg-dark);
        }
        #game2-container .controls button.active-mode {
            background-color: var(--cp-accent-magenta); color: var(--cp-bg-dark); border-color: var(--cp-accent-magenta);
        }
        #game2-container .param-controls { background-color: transparent; border: 1px solid var(--cp-border-neon); padding: 1rem; }
        #game2-container .param-controls label { color: var(--cp-text-neon-lime); }
        #game2-container .explanation, #game2-container .reason-box {
            background-color: rgba(0,0,0,0.3); border: 1px solid var(--cp-border-neon);
            padding: 1rem; color: var(--cp-text-primary);
        }
        #game2-container .reason-box { border-left-width: 4px; }
        #game2-container .reason-box.period-reason { border-left-color: var(--cp-accent-green); }
        #infoG2 { color: var(--cp-text-neon-lime); }


        /* Game 3: å…ƒç´ é€±æœŸè¡¨é…å° Specific Styles */
        /* ... (Game 3 CSS remains the same) ... */
        #periodic-table-game-grid {
            display: grid; grid-template-columns: repeat(18, minmax(18px, 1fr)); 
            gap: 2px; max-width: 900px; width: 100%; margin: 10px auto; padding: 3px; 
            background-color: rgba(0,0,0,0.2); 
            border: 1px solid var(--cp-border-neon); border-radius: 6px; 
        }
        .pt-cell {
            aspect-ratio: 1 / 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            background-color: var(--cp-bg-panel); 
            border: 1px solid var(--cp-accent-blue); border-radius: 3px; 
            font-size: clamp(0.4rem, 1.8vw, 0.65rem); 
            cursor: default; transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            padding: 1px; position: relative; overflow: hidden; line-height: 1.1;
            color: var(--cp-text-primary);
        }
        .pt-cell.empty-interactive {
            background-color: rgba(0, 255, 255, 0.15); border-color: var(--cp-accent-cyan);
        }
        .pt-cell.empty-interactive:hover { background-color: rgba(0, 255, 255, 0.3); }
        .pt-cell .atomic-number {
            font-size: clamp(0.35rem, 1.2vw, 0.55rem); position: absolute; top: 1px; left: 2px;
            color: var(--cp-text-neon-cyan); opacity: 0.7;
        }
        .pt-cell .symbol {
            font-size: clamp(0.55rem, 3vw, 1.2rem); font-weight: 700; line-height: 1; 
            color: var(--cp-text-neon-lime); 
        }
        .pt-cell .name {
            font-size: clamp(0.3rem, 1.2vw, 0.5rem); margin-top: 1px; text-align: center; line-height: 1;
            display: none; color: var(--cp-text-primary);
        }
        @media (min-width: 360px) { 
             .pt-cell { font-size: clamp(0.4rem, 1.8vw, 0.7rem); }
             .pt-cell .symbol { font-size: clamp(0.6rem, 3.2vw, 1.25rem); }
             .pt-cell .name { font-size: clamp(0.35rem, 1.3vw, 0.55rem); }
        }
        @media (min-width: 480px) { 
            .pt-cell .name { display: block; } 
            #periodic-table-game-grid { gap: 3px; grid-template-columns: repeat(18, minmax(22px, 1fr));}
            .pt-cell .symbol { font-size: clamp(0.7rem, 3.5vw, 1.4rem); }
            .pt-cell .name { font-size: clamp(0.4rem, 1.5vw, 0.6rem); }
        }
        @media (min-width: 768px) { 
            #periodic-table-game-grid { grid-template-columns: repeat(18, minmax(35px, 1fr)); gap: 4px; }
            .pt-cell { padding: 2px; }
            .pt-cell .atomic-number { font-size: clamp(0.55rem, 2vw, 0.75rem); }
            .pt-cell .symbol { font-size: clamp(0.9rem, 4vw, 1.6rem); }
            .pt-cell .name { font-size: clamp(0.5rem, 1.8vw, 0.75rem); }
        }
        #current-element-display { color: var(--cp-text-neon-magenta); font-weight: bold; }
        #element-fact-window {
            background-color: rgba(0,0,0,0.3); border: 1px solid var(--cp-border-neon);
            color: var(--cp-text-primary);
        }
        #element-fact-window h3 { color: var(--cp-text-neon-lime); }
        #game3-message.text-green-600 { color: var(--cp-accent-green) !important; }
        #game3-message.text-red-600 { color: var(--cp-accent-magenta) !important; }
        #game3-win-message {
            background-color: var(--cp-accent-green); color: var(--cp-bg-dark);
            border: 2px solid var(--cp-accent-green); box-shadow: 0 0 15px var(--cp-accent-green);
        }
        #game3-win-message h2 { color: var(--cp-bg-dark); text-shadow: none; }
        #restart-game3-button { 
            background-color: var(--cp-bg-dark); color: var(--cp-accent-green);
            border: 1px solid var(--cp-accent-green);
        }
        #restart-game3-button:hover { background-color: #002b00; }
        #game3-container .game-content-area.game-board-flash-red { 
            animation: flashRedBackgroundCyber 0.5s ease-in-out;
        }
        @keyframes flashRedBackgroundCyber { 
            0%, 100% { background-color: transparent; } 
            50% { background-color: rgba(255, 0, 0, 0.3); box-shadow: 0 0 15px red; } 
        }

    </style>
</head>
<body>

    <div id="homepage">
        <h1 class="homepage-title">åŒ–å­¸å¥‡å¢ƒ</h1>
        <p class="homepage-subtitle">æ¢ç´¢å…ƒç´ çš„å¥§ç§˜ï¼ŒæŒ‘æˆ°åŒ–å­¸çš„æ¨‚è¶£ã€‚æº–å‚™å¥½é€²å…¥äº’å‹•éŠæˆ²æ¨‚åœ’äº†å—ï¼Ÿ</p>
        <button id="enter-app-button" class="enter-button">é€²å…¥æ¨‚åœ’</button>
    </div>

    <div id="main-app-area">
        <header>
            <h1 class="text-2xl md:text-3xl font-bold text-center">åŒ–å­¸å¥‡å¢ƒï¼šäº’å‹•éŠæˆ²æ¨‚åœ’</h1>
        </header>

        <nav class="flex flex-wrap justify-center space-x-2 sm:space-x-4">
            <button id="nav-game1" class="nav-button active-nav-button">åŒ–å­¸é…å°æ¶ˆæ¶ˆæ¨‚</button>
            <button id="nav-game2" class="nav-button">åŸå­åŠå¾‘å¤§å°è®ŠåŒ–</button>
            <button id="nav-game3" class="nav-button">å…ƒç´ é€±æœŸè¡¨é…å°</button>
        </nav>

        <main class="flex-grow">
            <div id="game1-container" class="game-container">
                <div class="flex flex-col items-center justify-center p-1">
                    <h1 class="text-3xl md:text-4xl font-bold mb-6 text-center">åŒ–å­¸é…å°æ¶ˆæ¶ˆæ¨‚</h1>
                    <div id="startScreenG1" class="fade-in text-center">
                        <button id="startButtonG1" class="game-button game-button-green px-6 py-3 text-lg">
                            é–‹å§‹éŠæˆ²
                        </button>
                    </div>
                    <div class="my-4"> 
                        <button id="restartInGameButtonG1" class="game-button game-button-blue px-4 py-2 text-sm" style="display: none;">
                            é‡æ–°é–‹å§‹æœ¬å±€
                        </button>
                    </div>
                    <div class="flex flex-col lg:flex-row gap-4 md:gap-8 w-full max-w-4xl">
                        <div id="gridG1" class="mx-auto" style="display: none;">
                            </div>
                        <div id="leaderboardG1" class="p-4 md:p-6 rounded-lg w-full lg:w-80 order-first lg:order-last" style="display: none;">
                            <h2 class="text-xl font-bold mb-4">æ’è¡Œæ¦œ</h2>
                            <ul id="leaderboardListG1" class="space-y-2"></ul>
                            <button id="clearLeaderboardG1" class="game-button game-button-red px-4 py-2 mt-4 w-full">
                                æ¸…é™¤æ’å
                            </button>
                        </div>
                    </div>
                    <p id="messageG1" class="text-lg md:text-xl font-semibold mt-6 text-center"></p>
                    <div id="restartScreenG1" class="fade-in mt-4 text-center" style="display: none;">
                        <button id="restartButtonG1" class="game-button game-button-blue px-6 py-3 text-lg">
                            é‡æ–°é–‹å§‹æ–°ä¸€è¼ª
                        </button>
                    </div>
                    <p class="text-xl md:text-2xl font-bold mt-6">åˆ†æ•¸: <span id="scoreG1">0</span></p>
                    <div id="nameInputModalG1" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4" style="display: none; z-index: 999;">
                        <div class="modal-content-areaG1 p-6 rounded-lg shadow-xl w-full max-w-md">
                            <h2 class="text-xl font-bold mb-4">è¼¸å…¥ä½ çš„åç¨±</h2>
                            <input type="text" id="playerNameG1" class="cyber-input w-full mb-4" placeholder="ä½ çš„åç¨±">
                            <button id="confirmNameG1" class="game-button game-button-green px-6 py-2 w-full">
                                ç¢ºèª
                            </button>
                        </div>
                    </div>
                    <div id="celebrationG1" class="celebration" style="display: none;">
                        <div class="celebration-message">æ­å–œä½ å®ŒæˆéŠæˆ²ï¼</div>
                        <div class="celebration-message" style="font-size: clamp(1rem, 4vw, 2rem);">ä½ çš„åˆ†æ•¸: <span id="finalScoreG1">0</span></div>
                    </div>
                </div>
            </div>

            <div id="game2-container" class="game-container" style="display: none;">
                <div class="flex flex-col items-center p-1">
                    <h1 class="text-3xl md:text-4xl font-bold mb-6 text-center">åŸå­åŠå¾‘å¤§å°è®ŠåŒ–</h1>
                    <div class="controls flex flex-wrap justify-center gap-2 mb-4">
                        <button onclick="toggleModeG2('group')" id="groupBtnG2">ä¸»æ—è®ŠåŒ–æ¨¡å¼</button>
                        <button onclick="handleReasonG2('group')" id="groupReasonBtnG2">åŸå›  (ä¸»æ—)</button>
                        <button onclick="toggleModeG2('period')" id="periodBtnG2">é€±æœŸè®ŠåŒ–æ¨¡å¼</button>
                        <button onclick="handleReasonG2('period')" id="periodReasonBtnG2">åŸå›  (é€±æœŸ)</button>
                    </div>
                    
                    <div class="param-controls rounded-lg shadow mb-4 w-full max-w-lg text-center">
                        <label class="block mb-2">é›»å­å±¤æ•¸ (n):
                            <select id="layersG2" onchange="updateParamsG2()" class="ml-2 p-1 rounded cyber-input">
                                <option value="1">1</option> <option value="2" selected>2</option> <option value="3">3</option>
                                <option value="4">4</option> <option value="5">5</option>
                            </select>
                        </label>
                        <label class="block">æœ€å¤–å±¤é›»å­æ•¸:
                            <select id="electronsG2" onchange="updateParamsG2()" class="ml-2 p-1 rounded cyber-input">
                                <option value="1">1</option> <option value="2">2</option> <option value="3">3</option>
                                <option value="4">4</option> <option value="5">5</option> <option value="6">6</option>
                                <option value="7">7</option> <option value="8">8</option>
                            </select>
                        </label>
                    </div>
                    <canvas id="atomCanvasG2" width="600" height="400"></canvas> 
                    <div id="infoG2" class="explanation text-center"></div>
                    <div id="reasonG2" class="reason-box"></div>
                </div>
            </div>

            <div id="game3-container" class="game-container" style="display: none;">
                 <div class="flex flex-col items-center p-1 game-content-area">
                    <h1 class="text-3xl md:text-4xl font-bold mb-6 text-center">å…ƒç´ é€±æœŸè¡¨é…å°</h1>
                    
                    <div class="mb-4 p-4 rounded-lg shadow text-center w-full max-w-md" style="background-color: rgba(77,77,255,0.2); border: 1px solid var(--cp-accent-blue);">
                        <p class="text-lg" style="color: var(--cp-text-primary);">ç›®å‰è¦æ”¾ç½®çš„å…ƒç´ ï¼š</p>
                        <p id="current-element-display" class="text-2xl font-bold">-</p>
                    </div>

                    <div class="flex space-x-4 mb-6">
                        <button id="dice-buttonG3" class="game-button game-button-red px-6 py-3 text-lg">
                            ğŸ² æ“²éª°å­å–å…ƒç´ 
                        </button>
                        <button id="restart-game-buttonG3" class="game-button game-button-blue px-6 py-3 text-lg">
                            é‡æ–°é–‹å§‹éŠæˆ²
                        </button>
                    </div>


                    <div id="periodic-table-game-grid">
                        </div>

                    <div id="element-fact-window" class="mt-6 p-4 rounded-lg shadow w-full max-w-2xl text-center">
                        <h3 class="font-semibold text-lg mb-1">å…ƒç´ å°çŸ¥è­˜ï¼š</h3>
                        <p id="fact-text" class="text-base">-</p>
                    </div>
                    
                    <p id="game3-message" class="text-xl font-semibold mt-4"></p>

                    <div id="game3-win-message" class="hidden mt-6 p-6 rounded-lg shadow-xl text-center">
                        <h2 class="text-3xl font-bold mb-2">ğŸ‰ æ­å–œï¼ ğŸ‰</h2>
                        <p class="text-xl">æ‚¨å·²æˆåŠŸå®Œæˆå…ƒç´ é€±æœŸè¡¨ï¼</p>
                        <button id="play-again-game3-button" class="mt-4 font-bold py-2 px-4 rounded-lg transition game-button game-button-green">
                            å†ç©ä¸€æ¬¡
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            Â© 2025 åŒ–å­¸éŠæˆ²æ¨‚åœ’
        </footer>
    </div>

    <script>
        // Homepage and Main App Navigation
        const homepage = document.getElementById('homepage');
        const mainAppArea = document.getElementById('main-app-area');
        const enterAppButton = document.getElementById('enter-app-button');

        enterAppButton.addEventListener('click', () => {
            homepage.style.display = 'none';
            mainAppArea.style.display = 'flex'; 
            showGame('game1'); 
        });

        const navButtons = document.querySelectorAll('.nav-button');
        const gameContainers = document.querySelectorAll('.game-container');

        function showGame(gameId) {
            gameContainers.forEach(container => { container.style.display = 'none'; });
            navButtons.forEach(button => { button.classList.remove('active-nav-button'); });
            document.getElementById(gameId + '-container').style.display = 'block';
            const navButtonForGame = document.getElementById('nav-' + gameId);
            if (navButtonForGame) { navButtonForGame.classList.add('active-nav-button'); }
            
            if (gameId === 'game1') { 
                const restartInGameBtnG1 = document.getElementById('restartInGameButtonG1');
                if (restartInGameBtnG1 && gameActiveG1) restartInGameBtnG1.style.display = 'inline-block';
                else if(restartInGameBtnG1) restartInGameBtnG1.style.display = 'none';
            } else {
                const restartInGameBtnG1 = document.getElementById('restartInGameButtonG1');
                if (restartInGameBtnG1) restartInGameBtnG1.style.display = 'none';
            }

            if (gameId === 'game2') {
                 if (typeof initGame2 === "function" && !game2Initialized) initGame2();
                 else if (typeof drawAtomG2 === "function") drawAtomG2(); 
            } else if (gameId === 'game3') {
                if (typeof initGame3 === "function" && !game3Initialized) initGame3();
            }
        }
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const gameId = button.id.replace('nav-', '');
                showGame(gameId);
            });
        });

        // --- Game 1: åŒ–å­¸é…å°æ¶ˆæ¶ˆæ¨‚ Script ---
        const chemicalPairsG1 = [ 
            { name: 'æ°¯åŒ–é‰€', formula: 'KCl' }, { name: 'ä¸€æ°§åŒ–äºŒæ°®', formula: 'Nâ‚‚O' },
            { name: 'æ°§åŒ–éµ', formula: 'Feâ‚‚Oâ‚ƒ' }, { name: 'äºŒæ°§åŒ–ç¢³', formula: 'COâ‚‚' },
            { name: 'äºŒæ°§åŒ–ç¡…', formula: 'SiOâ‚‚' }, { name: 'ç¡é…¸', formula: 'HNOâ‚ƒ' },
            { name: 'ç¢³é…¸', formula: 'Hâ‚‚COâ‚ƒ' }, { name: 'ç¡«é…¸', formula: 'Hâ‚‚SOâ‚„' },
            { name: 'ç¡«é…¸é‰€', formula: 'Kâ‚‚SOâ‚„' }, { name: 'ç¢³é…¸é‚', formula: 'MgCOâ‚ƒ' },
            { name: 'ç¡é…¸éˆ‰', formula: 'NaNOâ‚ƒ' }, { name: 'ç¢³é…¸éˆ£', formula: 'CaCOâ‚ƒ' },
            { name: 'æ°´', formula: 'Hâ‚‚O' }, { name: 'å››æ°§åŒ–ä¸‰éµ', formula: 'Feâ‚ƒOâ‚„' },
            { name: 'äº”æ°§åŒ–äºŒæ°®', formula: 'Nâ‚‚Oâ‚…' }, { name: 'ä¸ƒæ°§åŒ–äºŒæ°¯', formula: 'Clâ‚‚Oâ‚‡' },
            { name: 'ç¡«é…¸éˆ‰', formula: 'Naâ‚‚SOâ‚„' }, { name: 'ç¢³é…¸é‹', formula: 'Alâ‚‚(COâ‚ƒ)â‚ƒ' },
            { name: 'æ°§æ°£', formula: 'Oâ‚‚' }, { name: 'æ°«æ°£', formula: 'Hâ‚‚' }, { name: 'æ°¦æ°£', formula: 'He' },
            { name: 'é‰€', formula: 'K' }, { name: 'éˆ‰', formula: 'Na' }, { name: 'æ°–æ°£', formula: 'Ne' },
            { name: 'ç¡…', formula: 'Si' }, 
            { name: 'æ°§åŒ–éˆ‰', formula: 'Naâ‚‚O' }, { name: 'æ°¯åŒ–æ°«', formula: 'HCl' },
            { name: 'ç¡«åŒ–éˆ‰', formula: 'Naâ‚‚S' }, { name: 'äºŒæ°§åŒ–ç¡«', formula: 'SOâ‚‚' },
            { name: 'ä¸‰æ°§åŒ–ç¡«', formula: 'SOâ‚ƒ' }, { name: 'æ°§åŒ–éˆ£', formula: 'CaO' },
            { name: 'æ°§åŒ–é‚', formula: 'MgO' }, { name: 'æ°§åŒ–éŠ…', formula: 'CuO' },
            { name: 'æ°¯åŒ–éˆ‰', formula: 'NaCl' }, { name: 'ç¡é…¸é‚', formula: 'Mg(NOâ‚ƒ)â‚‚' },
            { name: 'ç¢³é…¸éˆ‰', formula: 'Naâ‚‚COâ‚ƒ' }, { name: 'æ°¯åŒ–éˆ£', formula: 'CaClâ‚‚' },
            { name: 'ç¡«é…¸é‹', formula: 'Alâ‚‚(SOâ‚„)â‚ƒ' }, { name: 'ç£·é…¸éˆ‰', formula: 'Naâ‚ƒPOâ‚„' },
            { name: 'æ°¯åŒ–éŠ¨', formula: 'NHâ‚„Cl' }, { name: 'ç¡«é…¸äºéµ', formula: 'FeSOâ‚„' },
            { name: 'ç¡é…¸é‹', formula: 'Al(NOâ‚ƒ)â‚ƒ' }, { name: 'äºŒæ°§åŒ–éŒ³', formula: 'MnOâ‚‚' },
            { name: 'æ°§åŒ–é‰›', formula: 'PbO' }, { name: 'æ°§åŒ–éŠ€', formula: 'Agâ‚‚O' },
            { name: 'æ°§åŒ–æ±', formula: 'HgO' }, { name: 'æ°§åŒ–é‹…', formula: 'ZnO' }, 
            { name: 'æ°§åŒ–äºéŠ…', formula: 'Cuâ‚‚O' }, { name: 'æ°§åŒ–äºéµ', formula: 'FeO' },
            { name: 'æ°§åŒ–é‹', formula: 'Alâ‚‚Oâ‚ƒ' }, { name: 'æ°¯åŒ–é‹', formula: 'AlClâ‚ƒ' },
            { name: 'æ°¯åŒ–éµ', formula: 'FeClâ‚ƒ' }, { name: 'æ°¯åŒ–é‹…', formula: 'ZnClâ‚‚' },
            { name: 'æ°¯åŒ–éŠ…', formula: 'CuClâ‚‚' }, { name: 'æ°¯åŒ–éŠ€', formula: 'AgCl' },
            { name: 'ç¡«é…¸éˆ£', formula: 'CaSOâ‚„' }, { name: 'ç¡«é…¸éµ', formula: 'Feâ‚‚(SOâ‚„)â‚ƒ' },
            { name: 'ç¡«é…¸é‹…', formula: 'ZnSOâ‚„' }, { name: 'ç¡é…¸é‰€', formula: 'KNOâ‚ƒ' },
            { name: 'ç¡é…¸éˆ£', formula: 'Ca(NOâ‚ƒ)â‚‚' }, { name: 'ç¡é…¸éµ', formula: 'Fe(NOâ‚ƒ)â‚ƒ' },
            { name: 'ç¡é…¸éŠ…', formula: 'Cu(NOâ‚ƒ)â‚‚' }
        ];
        const gridSizeG1 = 4;
        let cardsG1 = [], selectedCardsG1 = [], matchedCardsCountG1 = 0; 
        let scoreG1 = 0, startTimeG1, timerG1, playerNameG1 = '';
        let leaderboardG1 = JSON.parse(localStorage.getItem('leaderboardG1')) || [];
        let gameActiveG1 = false;

        const startScreenG1 = document.getElementById('startScreenG1');
        const gridElementG1 = document.getElementById('gridG1');
        const leaderboardElementG1 = document.getElementById('leaderboardG1');
        const restartScreenG1 = document.getElementById('restartScreenG1'); 
        const restartInGameButtonG1 = document.getElementById('restartInGameButtonG1'); 
        const messageElementG1 = document.getElementById('messageG1');
        const scoreDisplayG1 = document.getElementById('scoreG1');
        const nameInputModalG1 = document.getElementById('nameInputModalG1');
        const celebrationElementG1 = document.getElementById('celebrationG1');
        const finalScoreDisplayG1 = document.getElementById('finalScoreG1');

        function updateLeaderboardG1() { 
            const leaderboardList = document.getElementById('leaderboardListG1');
            leaderboardList.innerHTML = '';
            leaderboardG1.sort((a, b) => b.score - a.score);
            leaderboardG1.slice(0, 8).forEach((entry, index) => {
                const li = document.createElement('li');
                li.className = 'text-sm md:text-base py-1';
                li.textContent = `${index + 1}. ${entry.name}: ${entry.score} åˆ†`;
                leaderboardList.appendChild(li);
            });
        }
        function getRandomPairsG1() { 
            const shuffledPairs = [...chemicalPairsG1].sort(() => Math.random() - 0.5);
            const neededPairs = (gridSizeG1 * gridSizeG1) / 2;
            const selectedPairs = shuffledPairs.slice(0, Math.min(neededPairs, shuffledPairs.length));
            while (selectedPairs.length < neededPairs && chemicalPairsG1.length > 0) {
                selectedPairs.push(chemicalPairsG1[Math.floor(Math.random() * chemicalPairsG1.length)]);
            }
            const allItems = [];
            selectedPairs.forEach(pair => {
                allItems.push({ type: 'name', value: pair.name, pairId: pair.formula });
                allItems.push({ type: 'formula', value: pair.formula, pairId: pair.formula });
            });
            return allItems.sort(() => Math.random() - 0.5);
        }
        
        function createGridG1() { 
            gridElementG1.innerHTML = ''; 
            cardsG1 = []; 
            matchedCardsCountG1 = 0; 
            selectedCardsG1 = []; 
            gameActiveG1 = true;
            if(restartInGameButtonG1) restartInGameButtonG1.style.display = 'inline-block'; 

            const allItems = getRandomPairsG1();
            if (allItems.length < gridSizeG1 * gridSizeG1) {
                console.error("Not enough items to fill the grid for Game 1.");
                return;
            }

            for (let i = 0; i < gridSizeG1 * gridSizeG1; i++) {
                const cardContainer = document.createElement('div');
                cardContainer.className = 'card-containerG1';
                
                const card = document.createElement('div');
                card.className = 'cardG1'; // Only one face now
                card.dataset.index = i;
                card.dataset.pairId = allItems[i].pairId;
                card.dataset.type = allItems[i].type;
                card.textContent = allItems[i].value; // Directly set content

                cardContainer.appendChild(card);
                gridElementG1.appendChild(cardContainer);
                
                cardsG1.push(card); 
                card.addEventListener('click', () => handleCardClickG1(card));
            }
        }

        function handleCardClickG1(card) {
            if (!gameActiveG1 || card.classList.contains('selected') || card.classList.contains('matched') || selectedCardsG1.length >= 2) {
                return;
            }
            card.classList.add('selected');
            selectedCardsG1.push(card);
            if (selectedCardsG1.length === 2) {
                checkMatchG1();
            }
        }

        function checkMatchG1() {
            const [card1, card2] = selectedCardsG1;
            if (card1.dataset.type !== card2.dataset.type && card1.dataset.pairId === card2.dataset.pairId) {
                const timeElapsed = (Date.now() - startTimeG1) / 1000;
                const points = Math.max(100 - Math.floor(timeElapsed / 2), 10); 
                scoreG1 += points; 
                scoreDisplayG1.textContent = scoreG1;
                showScorePopupG1(card1, points); 

                card1.classList.remove('selected');
                card2.classList.remove('selected');
                card1.classList.add('matched'); 
                card2.classList.add('matched');
                matchedCardsCountG1 += 2;

                if (matchedCardsCountG1 === gridSizeG1 * gridSizeG1) {
                    gameActiveG1 = false;
                    clearInterval(timerG1); 
                    messageElementG1.textContent = 'æ­å–œï¼ä½ è´äº†ï¼';
                    leaderboardG1.push({ name: playerNameG1, score: scoreG1 });
                    localStorage.setItem('leaderboardG1', JSON.stringify(leaderboardG1));
                    updateLeaderboardG1(); 
                    showCelebrationG1();
                    if(restartInGameButtonG1) restartInGameButtonG1.style.display = 'none'; 
                }
            } else {
                scoreG1 = Math.max(0, scoreG1 - 20); 
                scoreDisplayG1.textContent = scoreG1; 
                showPenaltyPopupG1();
                // Shake the card containers
                card1.parentElement.classList.add('shake');
                card2.parentElement.classList.add('shake');
                setTimeout(() => {
                    card1.classList.remove('selected');
                    card2.classList.remove('selected');
                    card1.parentElement.classList.remove('shake');
                    card2.parentElement.classList.remove('shake');
                }, 1000); 
            }
            selectedCardsG1 = [];
        }
        
        function showScorePopupG1(card, points) { 
            const popup = document.createElement('div');
            popup.className = 'score-popup'; popup.textContent = `+${points}`; popup.style.color = 'gold';
            const rect = card.getBoundingClientRect(); 
            popup.style.left = `${rect.left + rect.width / 2}px`; popup.style.top = `${rect.top + rect.height / 2}px`;
            popup.style.transform = 'translate(-50%, -50%)'; document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 2500);
        }
        function showPenaltyPopupG1() { 
            const popup = document.createElement('div');
            popup.className = 'score-popup'; popup.textContent = '-20'; popup.style.color = 'var(--cp-accent-magenta)';
            popup.style.left = '50%'; popup.style.top = '50%'; popup.style.transform = 'translate(-50%, -50%)';
            document.body.appendChild(popup); setTimeout(() => popup.remove(), 2500);
        }
        function showCelebrationG1() { 
            finalScoreDisplayG1.textContent = scoreG1; celebrationElementG1.style.display = 'flex';
            setTimeout(() => {
                celebrationElementG1.style.display = 'none'; restartScreenG1.style.display = 'block'; 
            }, 3000);
        }
        
        function startGameG1() { 
            startScreenG1.style.display = 'none'; gridElementG1.style.display = 'grid';
            leaderboardElementG1.style.display = 'block'; restartScreenG1.style.display = 'none'; 
            messageElementG1.textContent = ''; celebrationElementG1.style.display = 'none';
            scoreG1 = 0; scoreDisplayG1.textContent = scoreG1; 
            createGridG1(); 
            startTimeG1 = Date.now();
            if (timerG1) clearInterval(timerG1); 
            timerG1 = setInterval(() => {
                if (!gameActiveG1) { clearInterval(timerG1); return; }
                const timeElapsed = (Date.now() - startTimeG1) / 1000;
                messageElementG1.textContent = `æ™‚é–“: ${timeElapsed.toFixed(1)} ç§’`;
            }, 100);
        }

        function triggerRestartG1() { 
            gameActiveG1 = false;
            if (timerG1) clearInterval(timerG1);
            messageElementG1.textContent = 'æº–å‚™é‡æ–°é–‹å§‹...';
            if(restartInGameButtonG1) restartInGameButtonG1.style.display = 'none'; 
            nameInputModalG1.style.display = 'flex'; 
        }

        if(restartInGameButtonG1) restartInGameButtonG1.addEventListener('click', triggerRestartG1);
        document.getElementById('startButtonG1').addEventListener('click', () => { nameInputModalG1.style.display = 'flex'; });
        document.getElementById('confirmNameG1').addEventListener('click', () => {
            playerNameG1 = document.getElementById('playerNameG1').value.trim();
            if (playerNameG1) { nameInputModalG1.style.display = 'none'; startGameG1(); } 
            else {
                const nameInput = document.getElementById('playerNameG1');
                nameInput.classList.add('border-red-500'); nameInput.placeholder = "è«‹è¼¸å…¥æœ‰æ•ˆåç¨±ï¼";
                setTimeout(() => { nameInput.classList.remove('border-red-500'); nameInput.placeholder = "ä½ çš„åç¨±"; }, 2000);
            }
        });
        document.getElementById('restartButtonG1').addEventListener('click', () => nameInputModalG1.style.display = 'flex'); 
        document.getElementById('clearLeaderboardG1').addEventListener('click', () => {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ’åç´€éŒ„å—ï¼Ÿ')) { leaderboardG1 = []; localStorage.removeItem('leaderboardG1'); updateLeaderboardG1(); }
        });
        updateLeaderboardG1();

        // --- Game 2: åŸå­åŠå¾‘å¤§å°è®ŠåŒ– Script ---
        // (Game 2 JS remains the same)
        let canvasG2, ctxG2, currentModeG2, paramsG2, layerColorsG2, animationIdG2;
        let game2Initialized = false;
        function initGame2() { 
            if (game2Initialized && canvasG2) { if (animationIdG2) cancelAnimationFrame(animationIdG2); }
            canvasG2 = document.getElementById('atomCanvasG2');
            if (!canvasG2) { console.error("Canvas for Game 2 not found"); return; }
            ctxG2 = canvasG2.getContext('2d'); currentModeG2 = 'group'; 
            paramsG2 = {
                layers: 2, electrons: 1,
                physics: { baseAtomRadius: 120, layerSpacingPM: 60, shrinkPerElectronPM: 5, nucleusBaseFM: 5, nucleusLayerFM: 1.2, nucleusElectronFM: 0.3 },
                display: { pmToPixel: 0.3, fmToPixel: 0.1, chargeFont: 'bold 18px Arial', layerLabelFont: '12px Arial' }
            };
            layerColorsG2 = ['#00FFFF', '#39FF14', '#FF00FF', '#FFFF00', '#FF7F00']; 
            document.getElementById('layersG2').value = paramsG2.layers;
            document.getElementById('electronsG2').value = paramsG2.electrons;
            document.getElementById('groupBtnG2').classList.add('active-mode');
            document.getElementById('periodBtnG2').classList.remove('active-mode');
            document.getElementById('reasonG2').style.display = 'none';
            drawAtomG2(); game2Initialized = true;
        }
        function calculateAtomRadiusPMG2() { 
            if (currentModeG2 === 'group') { return paramsG2.physics.baseAtomRadius + (paramsG2.layers - 1) * paramsG2.physics.layerSpacingPM; }
            let baseRadiusForLayers = paramsG2.physics.baseAtomRadius + (paramsG2.layers - 1) * paramsG2.physics.layerSpacingPM;
            return baseRadiusForLayers - (paramsG2.electrons - 1) * paramsG2.physics.shrinkPerElectronPM * (paramsG2.layers); 
        }
        function calculateNucleusRadiusFMG2() { return paramsG2.physics.nucleusBaseFM + (paramsG2.layers - 1) * paramsG2.physics.nucleusLayerFM + (paramsG2.electrons - 1) * paramsG2.physics.nucleusElectronFM; }
        function toDisplayPMG2(pm) { return pm * paramsG2.display.pmToPixel; }
        function toDisplayFMG2(fm) { return fm * paramsG2.display.fmToPixel; }
        function handleReasonG2(mode) { 
            const reasonDiv = document.getElementById('reasonG2');
            if (currentModeG2 === mode) {
                let reasonText = '';
                if (mode === 'group') {
                    reasonText = `<b>åŒä¸»æ—ï¼ˆæœ€å¤–å±¤é›»å­æ•¸ä¸è®Šï¼Œé›»å­å±¤æ•¸å¢åŠ ï¼‰ï¼š</b><br>1. <b>é›»å­å±¤æ•¸å¢åŠ ï¼š</b>æ¯å¢åŠ ä¸€å€‹é›»å­å±¤ï¼ŒåŸå­é«”ç©é¡¯è‘—å¢å¤§ã€‚<br>2. <b>é®è”½æ•ˆæ‡‰ï¼š</b>å…§å±¤é›»å­å°å¤–å±¤é›»å­çš„æ’æ–¥éƒ¨åˆ†æŠµæ¶ˆäº†æ ¸é›»è·çš„å¸å¼•åŠ›ã€‚<br>3. <b>ä¸»è¦å› ç´ ï¼š</b>é›»å­å±¤æ•¸çš„å¢åŠ æ˜¯ä¸»å°å› ç´ ï¼Œå°è‡´åŸå­åŠå¾‘å¢å¤§ã€‚<br>å› æ­¤ï¼Œåœ¨åŒä¸€ä¸»æ—ä¸­ï¼Œå¾ä¸Šåˆ°ä¸‹ï¼ŒåŸå­åŠå¾‘ä¾æ¬¡å¢å¤§ã€‚`;
                    reasonDiv.className = 'reason-box p-4 rounded-md'; 
                } else { 
                    reasonText = `<b>åŒé€±æœŸï¼ˆé›»å­å±¤æ•¸ä¸è®Šï¼Œæ ¸é›»è·æ•¸åŠæœ€å¤–å±¤é›»å­æ•¸å¢åŠ ï¼‰ï¼š</b><br>1. <b>æ ¸é›»è·æ•¸å¢åŠ ï¼š</b>åŸå­æ ¸ä¸­çš„è³ªå­æ•¸å¢åŠ ï¼Œå°æ ¸å¤–é›»å­çš„å¸å¼•åŠ›å¢å¼·ã€‚<br>2. <b>æœ€å¤–å±¤é›»å­æ•¸å¢åŠ ï¼š</b>é›–ç„¶é›»å­é–“æœ‰æ’æ–¥ï¼Œä½†æ ¸é›»è·å¢åŠ çš„å¸å¼•æ•ˆæ‡‰æ›´å¼·ã€‚<br>3. <b>ä¸»è¦å› ç´ ï¼š</b>æ ¸é›»è·çš„æœ‰æ•ˆå¸å¼•åŠ›å¢åŠ æ˜¯ä¸»å°å› ç´ ï¼Œä½¿é›»å­é›²å‘åŸå­æ ¸æ”¶ç¸®ï¼Œå°è‡´åŸå­åŠå¾‘æ¸›å°ã€‚<br>å› æ­¤ï¼Œåœ¨åŒä¸€é€±æœŸä¸­ï¼Œå¾å·¦åˆ°å³ï¼ˆé™¤ç¨€æœ‰æ°£é«”å¤–ï¼‰ï¼ŒåŸå­åŠå¾‘ä¾æ¬¡æ¸›å°ã€‚`;
                    reasonDiv.className = 'reason-box period-reason p-4 rounded-md'; 
                }
                reasonDiv.innerHTML = reasonText;
                reasonDiv.style.display = reasonDiv.style.display === 'block' ? 'none' : 'block'; 
            } else { reasonDiv.style.display = 'none'; }
        }
        function toggleModeG2(mode) { 
            currentModeG2 = mode;
            document.getElementById('groupBtnG2').classList.toggle('active-mode', mode === 'group');
            document.getElementById('periodBtnG2').classList.toggle('active-mode', mode === 'period');
            document.getElementById('reasonG2').style.display = 'none'; 
            if (mode === 'group') { document.getElementById('electronsG2').value = 1; } 
            else { document.getElementById('layersG2').value = Math.min(parseInt(document.getElementById('layersG2').value), 3); }
            updateParamsG2(); 
        }
        function drawAtomG2() { 
            if (!ctxG2) return;
            const centerX = canvasG2.width / 2; const centerY = canvasG2.height / 2;
            ctxG2.clearRect(0, 0, canvasG2.width, canvasG2.height);
            const atomRadiusPM = calculateAtomRadiusPMG2(); const nucleusRadiusFM = calculateNucleusRadiusFMG2();
            const displayAtomRadius = Math.max(toDisplayPMG2(atomRadiusPM), 20); 
            const displayNucleus = Math.max(toDisplayFMG2(nucleusRadiusFM), 5); 
            const gradient = ctxG2.createRadialGradient(centerX, centerY, displayNucleus / 3, centerX, centerY, displayNucleus);
            gradient.addColorStop(0, 'rgba(255,0,255,0.8)'); gradient.addColorStop(1, 'rgba(255,0,128,1)');
            ctxG2.fillStyle = gradient; ctxG2.beginPath(); ctxG2.arc(centerX, centerY, displayNucleus, 0, Math.PI * 2); ctxG2.fill();
            ctxG2.fillStyle = 'white'; ctxG2.font = paramsG2.display.chargeFont;
            ctxG2.textAlign = 'center'; ctxG2.textBaseline = 'middle'; ctxG2.fillText('+', centerX, centerY);
            let currentLayerRadius = 0;
            for (let i = 0; i < paramsG2.layers; i++) {
                if (currentModeG2 === 'group') { currentLayerRadius = toDisplayPMG2(paramsG2.physics.baseAtomRadius / paramsG2.layers * (i + 1) + (i * paramsG2.physics.layerSpacingPM / 2)); }
                else { currentLayerRadius = toDisplayPMG2( (paramsG2.physics.baseAtomRadius + i * paramsG2.physics.layerSpacingPM) * (1 - (paramsG2.electrons -1) * paramsG2.physics.shrinkPerElectronPM / (paramsG2.physics.baseAtomRadius * 2) )); }
                currentLayerRadius = Math.max(currentLayerRadius, displayNucleus + 10 * (i + 1)); 
                ctxG2.strokeStyle = layerColorsG2[i % layerColorsG2.length]; ctxG2.lineWidth = 2;
                ctxG2.beginPath(); ctxG2.arc(centerX, centerY, currentLayerRadius, 0, Math.PI * 2); ctxG2.stroke();
                ctxG2.fillStyle = layerColorsG2[i % layerColorsG2.length]; ctxG2.font = paramsG2.display.layerLabelFont;
                ctxG2.fillText(`n=${i+1}`, centerX + currentLayerRadius + 10, centerY - 10);
                if (i === paramsG2.layers - 1) {
                    ctxG2.fillStyle = 'yellow'; 
                    const angleStep = (Math.PI * 2) / paramsG2.electrons;
                    for (let j = 0; j < paramsG2.electrons; j++) {
                        const angle = angleStep * j;
                        const x = centerX + Math.cos(angle) * currentLayerRadius;
                        const y = centerY + Math.sin(angle) * currentLayerRadius;
                        ctxG2.beginPath(); ctxG2.arc(x, y, 6, 0, Math.PI * 2); ctxG2.fill();
                        ctxG2.fillStyle = 'black'; ctxG2.font = paramsG2.display.chargeFont; ctxG2.fillText('-', x, y); 
                    }
                }
            }
            updateInfoG2(atomRadiusPM, nucleusRadiusFM);
        }
        function updateInfoG2(atomRadiusPM, nucleusRadiusFM) { 
            let infoText = currentModeG2 === 'group' ?
                `<b>åŒä¸»æ—å…ƒç´ </b> (æœ€å¤–å±¤é›»å­æ•¸: ${paramsG2.electrons})<br>é›»å­å±¤æ•¸ (n): ${paramsG2.layers}<br>` :
                `<b>åŒé€±æœŸå…ƒç´ </b> (é›»å­å±¤æ•¸ n: ${paramsG2.layers})<br>æœ€å¤–å±¤é›»å­æ•¸: ${paramsG2.electrons}<br>`;
            infoText += `ä¼°ç®—åŸå­åŠå¾‘: ${atomRadiusPM.toFixed(1)} pm<br>ä¼°ç®—åŸå­æ ¸åŠå¾‘: ${nucleusRadiusFM.toFixed(1)} fm`;
            document.getElementById('infoG2').innerHTML = infoText;
        }
        function updateParamsG2() { paramsG2.layers = parseInt(document.getElementById('layersG2').value); paramsG2.electrons = parseInt(document.getElementById('electronsG2').value); drawAtomG2(); }


        // --- Game 3: å…ƒç´ é€±æœŸè¡¨é…å° Script ---
        // (Game 3 JS remains the same)
        const periodicTableData = [ 
            { atomicNumber: 1, symbol: 'H', name_zh: 'æ°«', row: 1, col: 1, fact_zh: 'æ°«æ˜¯å®‡å®™ä¸­æœ€è¼•ã€å«é‡æœ€è±å¯Œçš„å…ƒç´ ï¼Œæ˜¯æ†æ˜Ÿçš„ä¸»è¦ç‡ƒæ–™ã€‚' },
            { atomicNumber: 2, symbol: 'He', name_zh: 'æ°¦', row: 1, col: 18, fact_zh: 'æ°¦æ°£éå¸¸è¼•ä¸”ä¸å¯ç‡ƒï¼Œå¸¸ç”¨æ–¼å¡«å……æ°£çƒå’Œé£›è‰‡ã€‚' },
            { atomicNumber: 3, symbol: 'Li', name_zh: 'é‹°', row: 2, col: 1, fact_zh: 'é‹°æ˜¯æœ€è¼•çš„é‡‘å±¬ï¼Œå»£æ³›æ‡‰ç”¨æ–¼å……é›»é›»æ± ä¸­ã€‚' },
            { atomicNumber: 4, symbol: 'Be', name_zh: 'éˆ¹', row: 2, col: 2, fact_zh: 'éˆ¹åˆé‡‘å …ç¡¬ä¸”è¼•ï¼Œç”¨æ–¼èˆªç©ºèˆªå¤©å·¥æ¥­ã€‚' },
            { atomicNumber: 5, symbol: 'B', name_zh: 'ç¡¼', row: 2, col: 13, fact_zh: 'ç¡¼ç”¨æ–¼è£½é€ ç»ç’ƒçº–ç¶­å’Œæ¸…æ½”åŠ‘ï¼Œä¹Ÿæ˜¯æ¤ç‰©å¿…éœ€çš„å¾®é‡å…ƒç´ ã€‚' },
            { atomicNumber: 6, symbol: 'C', name_zh: 'ç¢³', row: 2, col: 14, fact_zh: 'ç¢³æ˜¯æ‰€æœ‰ç”Ÿå‘½çš„åŸºç¤ï¼Œèƒ½å½¢æˆå¤šç¨®åŒ–åˆç‰©ï¼Œå¦‚é‘½çŸ³å’ŒçŸ³å¢¨ã€‚' },
            { atomicNumber: 7, symbol: 'N', name_zh: 'æ°®', row: 2, col: 15, fact_zh: 'æ°®æ°£ä½”åœ°çƒå¤§æ°£ç´„78%ï¼Œæ˜¯è›‹ç™½è³ªå’ŒDNAçš„é‡è¦çµ„æˆéƒ¨åˆ†ã€‚' },
            { atomicNumber: 8, symbol: 'O', name_zh: 'æ°§', row: 2, col: 16, fact_zh: 'æ°§æ°£å°å¤§å¤šæ•¸ç”Ÿå‘½è‡³é—œé‡è¦ï¼Œæ”¯æŒå‘¼å¸å’Œç‡ƒç‡’ã€‚' },
            { atomicNumber: 9, symbol: 'F', name_zh: 'æ°Ÿ', row: 2, col: 17, fact_zh: 'æ°Ÿæ˜¯æœ€å…·åæ‡‰æ€§çš„å…ƒç´ ï¼Œç”¨æ–¼ç‰™è†ä¸­ä»¥é˜²æ­¢è›€ç‰™ã€‚' },
            { atomicNumber: 10, symbol: 'Ne', name_zh: 'æ°–', row: 2, col: 18, fact_zh: 'æ°–æ°£åœ¨é€šé›»æ™‚ç™¼å‡ºç´…æ©™è‰²å…‰èŠ’ï¼Œç”¨æ–¼éœ“è™¹ç‡ˆã€‚' },
            { atomicNumber: 11, symbol: 'Na', name_zh: 'éˆ‰', row: 3, col: 1, fact_zh: 'éˆ‰æ˜¯é£Ÿé¹½çš„ä¸»è¦æˆåˆ†ä¹‹ä¸€ï¼Œå°ç¥ç¶“åŠŸèƒ½å’Œé«”æ¶²å¹³è¡¡å¾ˆé‡è¦ã€‚' },
            { atomicNumber: 12, symbol: 'Mg', name_zh: 'é‚', row: 3, col: 2, fact_zh: 'é‚æ˜¯è‘‰ç¶ ç´ çš„é—œéµæˆåˆ†ï¼Œä¹Ÿç”¨æ–¼è¼•è³ªåˆé‡‘ã€‚' },
            { atomicNumber: 13, symbol: 'Al', name_zh: 'é‹', row: 3, col: 13, fact_zh: 'é‹è¼•å·§ã€è€è…è•ï¼Œå»£æ³›ç”¨æ–¼é£›æ©Ÿã€æ±½è»Šå’ŒåŒ…è£ææ–™ã€‚' },
            { atomicNumber: 14, symbol: 'Si', name_zh: 'çŸ½', row: 3, col: 14, fact_zh: 'çŸ½æ˜¯æ²™å­å’Œç»ç’ƒçš„ä¸»è¦æˆåˆ†ï¼Œä¹Ÿæ˜¯åŠå°é«”å·¥æ¥­çš„åŸºç¤ã€‚' },
            { atomicNumber: 15, symbol: 'P', name_zh: 'ç£·', row: 3, col: 15, fact_zh: 'ç£·æ˜¯éª¨éª¼ã€ç‰™é½’å’ŒDNAçš„å¿…éœ€å…ƒç´ ï¼Œä¹Ÿç”¨æ–¼ç«æŸ´å’Œè‚¥æ–™ã€‚' },
            { atomicNumber: 16, symbol: 'S', name_zh: 'ç¡«', row: 3, col: 16, fact_zh: 'ç¡«å­˜åœ¨æ–¼æŸäº›æ°¨åŸºé…¸ä¸­ï¼Œç”¨æ–¼è£½é€ ç¡«é…¸å’Œç«è—¥ã€‚' },
            { atomicNumber: 17, symbol: 'Cl', name_zh: 'æ°¯', row: 3, col: 17, fact_zh: 'æ°¯å¸¸ç”¨æ–¼æ¶ˆæ¯’é£²ç”¨æ°´å’Œæ¸¸æ³³æ± ï¼Œä¹Ÿæ˜¯é£Ÿé¹½çš„æˆåˆ†ã€‚' },
            { atomicNumber: 18, symbol: 'Ar', name_zh: 'æ°¬', row: 3, col: 18, fact_zh: 'æ°¬æ°£æ˜¯ä¸€ç¨®æƒ°æ€§æ°£é«”ï¼Œç”¨æ–¼ç‡ˆæ³¡å’Œç„Šæ¥ã€‚' },
            { atomicNumber: 19, symbol: 'K', name_zh: 'é‰€', row: 4, col: 1, fact_zh: 'é‰€å°ç´°èƒåŠŸèƒ½è‡³é—œé‡è¦ï¼Œå­˜åœ¨æ–¼é¦™è•‰ç­‰é£Ÿç‰©ä¸­ã€‚' },
            { atomicNumber: 20, symbol: 'Ca', name_zh: 'éˆ£', row: 4, col: 2, fact_zh: 'éˆ£æ˜¯éª¨éª¼å’Œç‰™é½’çš„ä¸»è¦æˆåˆ†ï¼Œä¹Ÿåƒèˆ‡è‚Œè‚‰æ”¶ç¸®ã€‚' },
            { atomicNumber: 21, symbol: 'Sc', name_zh: 'éˆ§', row: 4, col: 3, fact_zh: 'éˆ§ç”¨æ–¼è£½é€ é«˜æ€§èƒ½åˆé‡‘å’ŒæŸäº›é¡å‹çš„ç…§æ˜è¨­å‚™ã€‚' },
            { atomicNumber: 22, symbol: 'Ti', name_zh: 'éˆ¦', row: 4, col: 4, fact_zh: 'éˆ¦å …å›ºã€è¼•å·§ä¸”è€è…è•ï¼Œç”¨æ–¼é£›æ©Ÿã€äººé€ é—œç¯€å’Œé¡æ–™ã€‚' },
            { atomicNumber: 23, symbol: 'V', name_zh: 'é‡©', row: 4, col: 5, fact_zh: 'é‡©ç”¨æ–¼è£½é€ å …å›ºçš„é‹¼åˆé‡‘ï¼Œå¦‚å·¥å…·é‹¼ã€‚' },
            { atomicNumber: 24, symbol: 'Cr', name_zh: 'é‰»', row: 4, col: 6, fact_zh: 'é‰»ç”¨æ–¼ä¸éŠ¹é‹¼å’Œéé‰»ï¼Œä½¿é‡‘å±¬è¡¨é¢å…‰äº®è€è…è•ã€‚' },
            { atomicNumber: 25, symbol: 'Mn', name_zh: 'éŒ³', row: 4, col: 7, fact_zh: 'éŒ³æ˜¯è£½é€ é‹¼éµçš„é‡è¦å…ƒç´ ï¼Œä¹Ÿåƒèˆ‡ç”Ÿç‰©é«”å…§çš„é…¶åæ‡‰ã€‚' },
            { atomicNumber: 26, symbol: 'Fe', name_zh: 'éµ', row: 4, col: 8, fact_zh: 'éµæ˜¯åœ°æ®¼ä¸­å«é‡è±å¯Œçš„é‡‘å±¬ï¼Œæ˜¯è¡€ç´…è›‹ç™½çš„é—œéµæˆåˆ†ï¼Œç”¨æ–¼é‹è¼¸æ°§æ°£ã€‚' },
            { atomicNumber: 27, symbol: 'Co', name_zh: 'éˆ·', row: 4, col: 9, fact_zh: 'éˆ·ç”¨æ–¼è£½é€ å¼·åŠ›ç£éµå’Œè—è‰²é¡æ–™ï¼Œä¹Ÿæ˜¯ç¶­ç”Ÿç´ B12çš„æˆåˆ†ã€‚' },
            { atomicNumber: 28, symbol: 'Ni', name_zh: 'é³', row: 4, col: 10, fact_zh: 'é³è€è…è•ï¼Œç”¨æ–¼è£½é€ ä¸éŠ¹é‹¼ã€ç¡¬å¹£å’Œé›»æ± ã€‚' },
            { atomicNumber: 29, symbol: 'Cu', name_zh: 'éŠ…', row: 4, col: 11, fact_zh: 'éŠ…å…·æœ‰å„ªè‰¯çš„å°é›»æ€§å’Œå°ç†±æ€§ï¼Œå»£æ³›ç”¨æ–¼é›»ç·šå’Œç®¡é“ã€‚' },
            { atomicNumber: 30, symbol: 'Zn', name_zh: 'é‹…', row: 4, col: 12, fact_zh: 'é‹…ç”¨æ–¼éé‹…ä»¥é˜²æ­¢éµç”Ÿé½ï¼Œä¹Ÿæ˜¯äººé«”å¿…éœ€çš„å¾®é‡å…ƒç´ ã€‚' }
        ];
        const gameGridG3 = document.getElementById('periodic-table-game-grid');
        const currentElementDisplayG3 = document.getElementById('current-element-display');
        const diceButtonG3 = document.getElementById('dice-buttonG3'); 
        const factTextG3 = document.getElementById('fact-text');
        const game3MessageG3 = document.getElementById('game3-message');
        const game3WinMessageG3 = document.getElementById('game3-win-message');
        const restartGameButtonG3 = document.getElementById('restart-game-buttonG3'); 
        const playAgainGame3ButtonG3 = document.getElementById('play-again-game3-button'); 

        const game3ContentArea = document.querySelector('#game3-container .game-content-area');

        let unplacedElementsG3 = [], currentElementToPlaceG3 = null, placedCountG3 = 0;
        let game3Initialized = false;

        function setupPeriodicTableG3() { 
            gameGridG3.innerHTML = ''; 
            for (let r = 1; r <= 4; r++) { 
                for (let c = 1; c <= 18; c++) { 
                    const cell = document.createElement('div');
                    cell.classList.add('pt-cell'); cell.dataset.row = r; cell.dataset.col = c;
                    const element = periodicTableData.find(el => el.row === r && el.col === c);
                    if (element) { cell.classList.add('empty-interactive'); cell.dataset.atomicNumber = element.atomicNumber; cell.addEventListener('click', handleCellClickG3); }
                    else { cell.classList.add('opacity-30', 'bg-slate-700'); } 
                    gameGridG3.appendChild(cell);
                }
            }
        }
        function rollDiceG3() { 
            if (unplacedElementsG3.length === 0) { currentElementDisplayG3.textContent = "å…¨éƒ¨å®Œæˆï¼"; diceButtonG3.disabled = true; return; }
            const randomIndex = Math.floor(Math.random() * unplacedElementsG3.length);
            currentElementToPlaceG3 = unplacedElementsG3[randomIndex];
            currentElementDisplayG3.textContent = `${currentElementToPlaceG3.symbol} (${currentElementToPlaceG3.name_zh})`;
            game3MessageG3.textContent = ''; diceButtonG3.disabled = true; 
        }
        function handleCellClickG3(event) { 
            if (!currentElementToPlaceG3) { game3MessageG3.textContent = "è«‹å…ˆæ“²éª°å­é¸æ“‡ä¸€å€‹å…ƒç´ ï¼"; return; }
            const clickedCell = event.currentTarget;
            if (clickedCell.classList.contains('filled')) { game3MessageG3.textContent = "é€™å€‹ä½ç½®å·²ç¶“å¡«å¥½äº†ï¼"; return; }
            const clickedAtomicNumber = parseInt(clickedCell.dataset.atomicNumber);

            if (clickedAtomicNumber === currentElementToPlaceG3.atomicNumber) {
                clickedCell.innerHTML = `<span class="atomic-number">${currentElementToPlaceG3.atomicNumber}</span><span class="symbol">${currentElementToPlaceG3.symbol}</span><span class="name">${currentElementToPlaceG3.name_zh}</span>`;
                clickedCell.classList.remove('empty-interactive'); clickedCell.classList.add('filled');
                clickedCell.style.backgroundColor = getColorForGroupG3(currentElementToPlaceG3.col); 
                clickedCell.style.color = 'var(--cp-bg-dark)'; 
                clickedCell.style.textShadow = 'none';
                factTextG3.textContent = currentElementToPlaceG3.fact_zh;
                game3MessageG3.textContent = `æ­£ç¢ºï¼ ${currentElementToPlaceG3.name_zh} æ”¾ç½®æˆåŠŸï¼`;
                game3MessageG3.classList.remove('text-red-600'); game3MessageG3.classList.add('text-green-600');
                unplacedElementsG3 = unplacedElementsG3.filter(el => el.atomicNumber !== currentElementToPlaceG3.atomicNumber);
                placedCountG3++; currentElementToPlaceG3 = null; currentElementDisplayG3.textContent = "-";
                diceButtonG3.disabled = false; 
                if (placedCountG3 === periodicTableData.length) {
                    game3WinMessageG3.style.display = 'block'; diceButtonG3.disabled = true;
                    restartGameButtonG3.style.display = 'none'; 
                    currentElementDisplayG3.textContent = "éŠæˆ²å‹åˆ©ï¼";
                }
            } else {
                game3MessageG3.textContent = "éŒ¯èª¤çš„ä½ç½®ï¼è«‹å†è©¦ä¸€æ¬¡ã€‚";
                game3MessageG3.classList.remove('text-green-600'); game3MessageG3.classList.add('text-red-600');
                if (game3ContentArea) { game3ContentArea.classList.add('game-board-flash-red'); setTimeout(() => { game3ContentArea.classList.remove('game-board-flash-red'); }, 500); }
            }
        }
        function getColorForGroupG3(column) { 
            if (column === 1) return 'var(--cp-text-neon-magenta)'; 
            if (column === 2) return '#FF7F00';  
            if (column >= 3 && column <= 12) return '#FFFF00'; 
            if (column === 13) return 'var(--cp-accent-green)'; 
            if (column === 14) return 'var(--cp-accent-blue)'; 
            if (column === 15) return '#7F00FF'; 
            if (column === 16) return '#FF1493'; 
            if (column === 17) return 'var(--cp-text-neon-cyan)'; 
            if (column === 18) return '#C0C0C0'; 
            return 'var(--cp-text-primary)'; 
        }
        function resetGame3() { 
            unplacedElementsG3 = [...periodicTableData]; currentElementToPlaceG3 = null; placedCountG3 = 0;
            setupPeriodicTableG3(); currentElementDisplayG3.textContent = "-";
            factTextG3.textContent = "-"; game3MessageG3.textContent = "";
            diceButtonG3.disabled = false; game3WinMessageG3.style.display = 'none';
            if(restartGameButtonG3) restartGameButtonG3.style.display = 'inline-block'; 
        }
        function initGame3() { 
            resetGame3(); 
            diceButtonG3.addEventListener('click', rollDiceG3);
            restartGameButtonG3.addEventListener('click', resetGame3); 
            playAgainGame3ButtonG3.addEventListener('click', resetGame3); 
            game3Initialized = true; 
        }
    </script>
</body>
</html>
