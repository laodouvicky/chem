<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ–å­¸å¥‡å¢ƒï¼šäº’å‹•éŠæˆ²æ¨‚åœ’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', 'Inter', sans-serif;
        }

        .nav-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: background-color 0.3s, color 0.3s;
            cursor: pointer;
            background-color: #4A5568; /* bg-slate-600 */
            color: white;
        }

        .nav-button:hover {
            background-color: #2D3748; /* bg-slate-700 */
        }

        .active-nav-button {
            background-color: #3B82F6; /* bg-blue-500 */
            color: white;
        }
        .active-nav-button:hover {
            background-color: #2563EB; /* bg-blue-600 */
        }

        .game-container {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-top: 1rem;
        }

        /* Game 1: åŒ–å­¸é…å°æ¶ˆæ¶ˆæ¨‚ Specific Styles */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0); }
        }
        @keyframes scoreFadeOut {
            0% { opacity: 1; transform: translateY(0) scale(1.8); }
            60% { opacity: 1; transform: translateY(-40px) scale(1.8); }
            100% { opacity: 0; transform: translateY(-80px) scale(1.8); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        .score-popup {
            position: fixed;
            font-weight: bold;
            font-size: 3rem; /* Adjusted for better visibility */
            text-shadow: 0 0 8px rgba(0,0,0,0.8);
            animation: scoreFadeOut 2.5s ease-out forwards;
            z-index: 1000; /* Ensure it's above other elements */
            pointer-events: none;
        }
        .cell-container { /* Game 1 */
            position: relative;
            width: clamp(60px, 15vw, 96px); /* Responsive cell size */
            height: clamp(60px, 15vh, 96px);
            transition: all 0.3s ease;
        }
        .cell-removing { /* Game 1 */
            animation: fadeOut 0.5s ease-out forwards;
        }
        .shake { /* Game 1 */
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        .celebration { /* Game 1 */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
        }
        .celebration-message { /* Game 1 */
            font-size: clamp(1.5rem, 5vw, 3rem); /* Responsive font size */
            font-weight: bold;
            color: gold;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
            margin-bottom: 2rem;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Game 2: åŸå­åŠå¾‘å¤§å°è®ŠåŒ– Specific Styles */
        #game2-container canvas {
            border: 1px solid #D1D5DB; /* Tailwind gray-300 */
            background: #F9FAFB; /* Tailwind gray-50 */
            margin: 10px auto; /* Center canvas */
            display: block;
            max-width: 100%;
            height: auto;
        }
        #game2-container .controls button, #game2-container .param-controls select {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: 1px solid #D1D5DB;
            background-color: white;
            transition: background-color 0.2s;
        }
        #game2-container .controls button:hover, #game2-container .param-controls select:hover {
            background-color: #F3F4F6; /* gray-100 */
        }
        #game2-container .controls button.active-mode {
            background-color: #3B82F6; /* blue-500 */
            color: white;
            border-color: #3B82F6;
        }
        #game2-container .explanation, #game2-container .reason-box {
            max-width: 600px; /* Match original width */
            margin: 10px auto; /* Center the boxes */
            padding: 1rem;
            border-radius: 0.375rem;
        }
        #game2-container .explanation {
            background-color: #E5E7EB; /* gray-200 */
        }
        #game2-container .reason-box {
            background-color: #DBEAFE; /* blue-100 */
            border-left: 4px solid #3B82F6; /* blue-500 */
            display: none; /* Initially hidden */
        }
        #game2-container .reason-box.period-reason { /* For period specific styling if needed */
            background-color: #D1FAE5; /* green-100 */
            border-left-color: #10B981; /* green-500 */
        }

        /* Game 3: å…ƒç´ é€±æœŸè¡¨é…å° Specific Styles - UPDATED */
        #periodic-table-game-grid {
            display: grid;
            grid-template-columns: repeat(18, minmax(35px, 1fr)); /* Cells at least 35px wide */
            gap: 4px;
            max-width: 900px; /* Max width of the entire table */
            width: 100%; /* Make it take full available width up to max-width */
            margin: 20px auto;
            padding: 5px; /* Reduced padding slightly */
            background-color: #e0e0e0; 
            border-radius: 8px;
        }
        .pt-cell {
            aspect-ratio: 1 / 1; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: clamp(0.6rem, 1.8vw, 0.9rem); /* Base font for cell, adjusted */
            cursor: default;
            transition: background-color 0.3s;
            padding: 2px; /* Added small padding inside cell */
            position: relative; /* For absolute positioning of atomic number */
            overflow: hidden; /* Prevent content spillover */
        }
        .pt-cell.empty-interactive {
            background-color: #a7f3d0; 
            cursor: pointer;
        }
        .pt-cell.empty-interactive:hover {
            background-color: #6ee7b7;
        }
        .pt-cell.filled {
            /* background-color will be set by JS using getColorForGroup */
            cursor: default;
        }
        .pt-cell .atomic-number {
            font-size: clamp(0.55rem, 2vw, 0.75rem); /* Adjusted */
            position: absolute;
            top: 2px;
            left: 3px;
            color: #555; /* Slightly dimmer color */
        }
        .pt-cell .symbol {
            font-size: clamp(0.9rem, 4vw, 1.6rem); /* Adjusted significantly for better visibility */
            font-weight: bold;
            line-height: 1; /* Compact line height */
        }
        .pt-cell .name {
            font-size: clamp(0.5rem, 1.8vw, 0.75rem); /* Adjusted */
            margin-top: 2px; /* Space below symbol */
            text-align: center;
            line-height: 1.1; /* Slightly more space for name lines */
        }
        #game3-container .game-board-flash-red { /* Main game area flash */
            animation: flashRedBackground 0.5s ease-in-out;
        }
        @keyframes flashRedBackground { /* Changed to target background of a larger container */
            0%, 100% { background-color: transparent; } /* Assuming parent is transparent or has its own bg */
            50% { background-color: #FECACA; } /* red-200 */
        }
        #element-fact-window {
            min-height: 50px; 
        }

    </style>
</head>
<body class="bg-slate-100 min-h-screen flex flex-col">
    <header class="bg-sky-700 text-white p-4 shadow-lg">
        <h1 class="text-2xl md:text-3xl font-bold text-center">åŒ–å­¸å¥‡å¢ƒï¼šäº’å‹•éŠæˆ²æ¨‚åœ’</h1>
    </header>

    <nav class="flex flex-wrap justify-center space-x-2 sm:space-x-4 p-3 bg-sky-600 shadow-md">
        <button id="nav-game1" class="nav-button active-nav-button">åŒ–å­¸é…å°æ¶ˆæ¶ˆæ¨‚</button>
        <button id="nav-game2" class="nav-button">åŸå­åŠå¾‘å¤§å°è®ŠåŒ–</button>
        <button id="nav-game3" class="nav-button">å…ƒç´ é€±æœŸè¡¨é…å°</button>
    </nav>

    <main class="flex-grow p-2 md:p-6">
        <div id="game1-container" class="game-container">
            <div class="flex flex-col items-center justify-center p-1">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-6 text-center">åŒ–å­¸é…å°æ¶ˆæ¶ˆæ¨‚</h1>
                <div id="startScreenG1" class="fade-in text-center">
                    <button id="startButtonG1" class="bg-green-500 text-white px-6 py-3 rounded-lg shadow-md hover:bg-green-600 transition duration-300 text-lg">
                        é–‹å§‹éŠæˆ²
                    </button>
                </div>
                <div class="flex flex-col lg:flex-row gap-4 md:gap-8 w-full max-w-4xl">
                    <div id="gridG1" class="grid grid-cols-4 gap-2 md:gap-4 mx-auto" style="display: none;"></div>
                    <div id="leaderboardG1" class="bg-white p-4 md:p-6 rounded-lg shadow-md w-full lg:w-80 order-first lg:order-last" style="display: none;">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">æ’è¡Œæ¦œ</h2>
                        <ul id="leaderboardListG1" class="space-y-2"></ul>
                        <button id="clearLeaderboardG1" class="bg-red-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-red-600 transition duration-300 mt-4 w-full">
                            æ¸…é™¤æ’å
                        </button>
                    </div>
                </div>
                <p id="messageG1" class="text-lg md:text-xl font-semibold text-gray-700 mt-6 text-center"></p>
                <div id="restartScreenG1" class="fade-in mt-4 text-center" style="display: none;">
                    <button id="restartButtonG1" class="bg-blue-500 text-white px-6 py-3 rounded-lg shadow-md hover:bg-blue-600 transition duration-300 text-lg">
                        é‡æ–°é–‹å§‹
                    </button>
                </div>
                <p class="text-xl md:text-2xl font-bold text-gray-800 mt-6">åˆ†æ•¸: <span id="scoreG1">0</span></p>
                <div id="nameInputModalG1" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4" style="display: none; z-index: 999;">
                    <div class="bg-white p-6 rounded-lg shadow-md w-full max-w-md">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">è¼¸å…¥ä½ çš„åç¨±</h2>
                        <input type="text" id="playerNameG1" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4" placeholder="ä½ çš„åç¨±">
                        <button id="confirmNameG1" class="bg-green-500 text-white px-6 py-2 rounded-lg shadow-md hover:bg-green-600 transition duration-300 w-full">
                            ç¢ºèª
                        </button>
                    </div>
                </div>
                <div id="celebrationG1" class="celebration" style="display: none;">
                    <div class="celebration-message">æ­å–œä½ å®ŒæˆéŠæˆ²ï¼</div>
                    <div class="celebration-message" style="font-size: clamp(1rem, 4vw, 2rem);">ä½ çš„åˆ†æ•¸: <span id="finalScoreG1">0</span></div>
                </div>
            </div>
        </div>

        <div id="game2-container" class="game-container" style="display: none;">
            <div class="flex flex-col items-center p-1">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-6 text-center">åŸå­åŠå¾‘å¤§å°è®ŠåŒ–</h1>
                <div class="controls flex flex-wrap justify-center gap-2 mb-4">
                    <button onclick="toggleModeG2('group')" id="groupBtnG2" class="active-mode">ä¸»æ—è®ŠåŒ–æ¨¡å¼</button>
                    <button onclick="handleReasonG2('group')" id="groupReasonBtnG2">åŸå›  (ä¸»æ—)</button>
                    <button onclick="toggleModeG2('period')" id="periodBtnG2">é€±æœŸè®ŠåŒ–æ¨¡å¼</button>
                    <button onclick="handleReasonG2('period')" id="periodReasonBtnG2">åŸå›  (é€±æœŸ)</button>
                    </div>
                
                <div class="param-controls bg-gray-100 p-4 rounded-lg shadow mb-4 w-full max-w-lg text-center">
                    <label class="block mb-2">é›»å­å±¤æ•¸ (n):
                        <select id="layersG2" onchange="updateParamsG2()" class="ml-2 p-1 border rounded">
                            <option value="1">1</option>
                            <option value="2" selected>2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </label>
                    
                    <label class="block">æœ€å¤–å±¤é›»å­æ•¸:
                        <select id="electronsG2" onchange="updateParamsG2()" class="ml-2 p-1 border rounded">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </label>
                </div>
            
                <canvas id="atomCanvasG2" width="600" height="400"></canvas> <div id="infoG2" class="explanation text-center"></div>
                <div id="reasonG2" class="reason-box"></div>
            </div>
        </div>

        <div id="game3-container" class="game-container" style="display: none;">
             <div class="flex flex-col items-center p-1"> {/* This div will be flashed red on error */}
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-6 text-center">å…ƒç´ é€±æœŸè¡¨é…å°</h1>
                
                <div class="mb-4 p-4 bg-indigo-100 rounded-lg shadow text-center w-full max-w-md">
                    <p class="text-lg">ç›®å‰è¦æ”¾ç½®çš„å…ƒç´ ï¼š</p>
                    <p id="current-element-display" class="text-2xl font-bold text-indigo-700">-</p>
                </div>

                <button id="dice-button" class="bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out mb-6 text-lg">
                    ğŸ² æ“²éª°å­å–å…ƒç´ 
                </button>

                <div id="periodic-table-game-grid">
                    </div>

                <div id="element-fact-window" class="mt-6 p-4 bg-lime-100 rounded-lg shadow w-full max-w-2xl text-center">
                    <h3 class="font-semibold text-lime-800 text-lg mb-1">å…ƒç´ å°çŸ¥è­˜ï¼š</h3>
                    <p id="fact-text" class="text-lime-700">-</p>
                </div>
                
                <p id="game3-message" class="text-xl font-semibold text-red-600 mt-4"></p>

                <div id="game3-win-message" class="hidden mt-6 p-6 bg-green-500 text-white rounded-lg shadow-xl text-center">
                    <h2 class="text-3xl font-bold mb-2">ğŸ‰ æ­å–œï¼ ğŸ‰</h2>
                    <p class="text-xl">æ‚¨å·²æˆåŠŸå®Œæˆå…ƒç´ é€±æœŸè¡¨ï¼</p>
                    <button id="restart-game3-button" class="mt-4 bg-white text-green-600 font-bold py-2 px-4 rounded-lg hover:bg-green-100 transition">
                        é‡æ–°é–‹å§‹
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center p-4 text-slate-600 text-sm bg-slate-200">
        Â© 2025 åŒ–å­¸éŠæˆ²æ¨‚åœ’
    </footer>

    <script>
        // Main Navigation Logic
        const navButtons = document.querySelectorAll('.nav-button');
        const gameContainers = document.querySelectorAll('.game-container');

        function showGame(gameId) {
            gameContainers.forEach(container => {
                container.style.display = 'none';
            });
            navButtons.forEach(button => {
                button.classList.remove('active-nav-button');
            });

            document.getElementById(gameId + '-container').style.display = 'block';
            document.getElementById('nav-' + gameId).classList.add('active-nav-button');
            
            // Special initialization if needed
            if (gameId === 'game2') {
                 if (typeof initGame2 === "function") initGame2();
            } else if (gameId === 'game3') {
                if (typeof initGame3 === "function" && !game3Initialized) initGame3();
            }
        }

        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const gameId = button.id.replace('nav-', '');
                showGame(gameId);
            });
        });

        // Show Game 1 by default
        showGame('game1');

        // --- Game 1: åŒ–å­¸é…å°æ¶ˆæ¶ˆæ¨‚ Script ---
        const chemicalPairsG1 = [
            { name: 'æ°¯åŒ–é‰€', formula: 'KCl' }, { name: 'ä¸€æ°§åŒ–äºŒæ°®', formula: 'Nâ‚‚O' },
            { name: 'æ°§åŒ–éµ', formula: 'Feâ‚‚Oâ‚ƒ' }, { name: 'äºŒæ°§åŒ–ç¢³', formula: 'COâ‚‚' },
            { name: 'äºŒæ°§åŒ–ç¡…', formula: 'SiOâ‚‚' }, { name: 'ç¡é…¸', formula: 'HNOâ‚ƒ' },
            { name: 'ç¢³é…¸', formula: 'Hâ‚‚COâ‚ƒ' }, { name: 'ç¡«é…¸', formula: 'Hâ‚‚SOâ‚„' },
            { name: 'ç¡«é…¸é‰€', formula: 'Kâ‚‚SOâ‚„' }, { name: 'ç¢³é…¸é‚', formula: 'MgCOâ‚ƒ' },
            { name: 'ç¡é…¸éˆ‰', formula: 'NaNOâ‚ƒ' }, { name: 'ç¢³é…¸éˆ£', formula: 'CaCOâ‚ƒ' },
            { name: 'ä¸€æ°§åŒ–äºŒæ°«', formula: 'Hâ‚‚O' }, { name: 'å››æ°§åŒ–ä¸‰éµ', formula: 'Feâ‚ƒOâ‚„' },
            { name: 'äº”æ°§åŒ–äºŒæ°®', formula: 'Nâ‚‚Oâ‚…' }, { name: 'ä¸ƒæ°§åŒ–äºŒæ°¯', formula: 'Clâ‚‚Oâ‚‡' },
            { name: 'ç¡«é…¸éˆ‰', formula: 'Naâ‚‚SOâ‚„' }, { name: 'ç¢³é…¸é‹', formula: 'Alâ‚‚(COâ‚ƒ)â‚ƒ' },
            { name: 'æ°§æ°£', formula: 'Oâ‚‚' }, { name: 'æ°«æ°£', formula: 'Hâ‚‚' }, { name: 'æ°¦æ°£', formula: 'He' },
            { name: 'é‰€', formula: 'K' }, { name: 'éˆ‰', formula: 'Na' }, { name: 'æ°–æ°£', formula: 'Ne' },
            { name: 'ç¡…', formula: 'Si' }, 
            { name: 'æ°§åŒ–éˆ‰', formula: 'Naâ‚‚O' }, { name: 'æ°¯åŒ–æ°«', formula: 'HCl' },
            { name: 'ç¡«åŒ–éˆ‰', formula: 'Naâ‚‚S' }, { name: 'äºŒæ°§åŒ–ç¡«', formula: 'SOâ‚‚' },
            { name: 'ä¸‰æ°§åŒ–ç¡«', formula: 'SOâ‚ƒ' }, { name: 'æ°§åŒ–éˆ£', formula: 'CaO' },
            { name: 'æ°§åŒ–é‚', formula: 'MgO' }, { name: 'æ°§åŒ–éŠ…', formula: 'CuO' },
            { name: 'æ°¯åŒ–éˆ‰', formula: 'NaCl' }, { name: 'ç¡é…¸é‚', formula: 'Mg(NOâ‚ƒ)â‚‚' },
            { name: 'ç¢³é…¸éˆ‰', formula: 'Naâ‚‚COâ‚ƒ' }, { name: 'æ°¯åŒ–éˆ£', formula: 'CaClâ‚‚' },
            { name: 'ç¡«é…¸é‹', formula: 'Alâ‚‚(SOâ‚„)â‚ƒ' }, { name: 'ç£·é…¸éˆ‰', formula: 'Naâ‚ƒPOâ‚„' },
            { name: 'æ°¯åŒ–éŠ¨', formula: 'NHâ‚„Cl' }, { name: 'ç¡«é…¸äºéµ', formula: 'FeSOâ‚„' },
            { name: 'ç¡é…¸é‹', formula: 'Al(NOâ‚ƒ)â‚ƒ' }, { name: 'äºŒæ°§åŒ–éŒ³', formula: 'MnOâ‚‚' },
            { name: 'æ°§åŒ–é‰›', formula: 'PbO' }, { name: 'æ°§åŒ–éŠ€', formula: 'Agâ‚‚O' },
            { name: 'æ°§åŒ–æ±', formula: 'HgO' }, { name: 'æ°§åŒ–é‹…', formula: 'ZnO' }, 
            { name: 'æ°§åŒ–äºéŠ…', formula: 'Cuâ‚‚O' }, { name: 'æ°§åŒ–äºéµ', formula: 'FeO' },
            { name: 'æ°§åŒ–é‹', formula: 'Alâ‚‚Oâ‚ƒ' }, { name: 'æ°¯åŒ–é‹', formula: 'AlClâ‚ƒ' },
            { name: 'æ°¯åŒ–éµ', formula: 'FeClâ‚ƒ' }, { name: 'æ°¯åŒ–é‹…', formula: 'ZnClâ‚‚' },
            { name: 'æ°¯åŒ–éŠ…', formula: 'CuClâ‚‚' }, { name: 'æ°¯åŒ–éŠ€', formula: 'AgCl' },
            { name: 'ç¡«é…¸éˆ£', formula: 'CaSOâ‚„' }, { name: 'ç¡«é…¸éµ', formula: 'Feâ‚‚(SOâ‚„)â‚ƒ' },
            { name: 'ç¡«é…¸é‹…', formula: 'ZnSOâ‚„' }, { name: 'ç¡é…¸é‰€', formula: 'KNOâ‚ƒ' },
            { name: 'ç¡é…¸éˆ£', formula: 'Ca(NOâ‚ƒ)â‚‚' }, { name: 'ç¡é…¸éµ', formula: 'Fe(NOâ‚ƒ)â‚ƒ' },
            { name: 'ç¡é…¸éŠ…', formula: 'Cu(NOâ‚ƒ)â‚‚' }
        ];
        const gridSizeG1 = 4;
        let gridArrG1 = [];
        let selectedCellsG1 = [];
        let matchedCellsG1 = [];
        let scoreG1 = 0;
        let startTimeG1;
        let timerG1;
        let playerNameG1 = '';
        let leaderboardG1 = JSON.parse(localStorage.getItem('leaderboardG1')) || [];

        const startScreenG1 = document.getElementById('startScreenG1');
        const gridElementG1 = document.getElementById('gridG1');
        const leaderboardElementG1 = document.getElementById('leaderboardG1');
        const restartScreenG1 = document.getElementById('restartScreenG1');
        const messageElementG1 = document.getElementById('messageG1');
        const scoreDisplayG1 = document.getElementById('scoreG1');
        const nameInputModalG1 = document.getElementById('nameInputModalG1');
        const celebrationElementG1 = document.getElementById('celebrationG1');
        const finalScoreDisplayG1 = document.getElementById('finalScoreG1');

        function updateLeaderboardG1() {
            const leaderboardList = document.getElementById('leaderboardListG1');
            leaderboardList.innerHTML = '';
            leaderboardG1.sort((a, b) => b.score - a.score);
            leaderboardG1.slice(0, 8).forEach((entry, index) => {
                const li = document.createElement('li');
                li.className = 'text-gray-700 text-sm md:text-lg';
                li.textContent = `${index + 1}. ${entry.name}: ${entry.score} åˆ†`;
                leaderboardList.appendChild(li);
            });
        }

        function getRandomPairsG1() {
            const shuffledPairs = [...chemicalPairsG1].sort(() => Math.random() - 0.5);
            const neededPairs = (gridSizeG1 * gridSizeG1) / 2;
            const selectedPairs = shuffledPairs.slice(0, Math.min(neededPairs, shuffledPairs.length));
            while (selectedPairs.length < neededPairs && chemicalPairsG1.length > 0) {
                selectedPairs.push(chemicalPairsG1[Math.floor(Math.random() * chemicalPairsG1.length)]);
            }

            const allItems = [];
            selectedPairs.forEach(pair => {
                allItems.push({ type: 'name', value: pair.name, pairId: pair.formula });
                allItems.push({ type: 'formula', value: pair.formula, pairId: pair.formula });
            });
            return allItems.sort(() => Math.random() - 0.5);
        }

        function createGridG1() {
            gridElementG1.innerHTML = '';
            gridArrG1 = [];
            const allItems = getRandomPairsG1();
            if (allItems.length < gridSizeG1 * gridSizeG1) {
                console.error("Not enough items to fill the grid. Check chemicalPairsG1.");
                while(allItems.length < gridSizeG1 * gridSizeG1) {
                    allItems.push({ type: 'name', value: 'éŒ¯èª¤', pairId: 'ERROR' });
                }
            }

            for (let i = 0; i < gridSizeG1 * gridSizeG1; i++) {
                const container = document.createElement('div');
                container.className = 'cell-container';
                
                const cell = document.createElement('div');
                cell.className = 'bg-green-500 text-white flex items-center justify-center text-center text-xs sm:text-sm md:text-base lg:text-xl font-semibold rounded-lg shadow-md cursor-pointer hover:bg-green-600 transition duration-300 w-full h-full p-1';
                cell.textContent = allItems[i].value;
                cell.dataset.pairId = allItems[i].pairId;
                cell.dataset.type = allItems[i].type;
                cell.dataset.index = i;
                cell.addEventListener('click', () => selectCellG1(cell, i));
                
                container.appendChild(cell);
                gridElementG1.appendChild(container);
                gridArrG1.push({ cell, container, index: i });
            }
        }
        
        function showScorePopupG1(cell, points) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = `+${points}`;
            popup.style.color = 'gold';
            const rect = cell.getBoundingClientRect();
            popup.style.left = `${rect.left + rect.width / 2}px`;
            popup.style.top = `${rect.top + rect.height / 2}px`;
            popup.style.transform = 'translate(-50%, -50%)';
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 2500);
        }

        function showPenaltyPopupG1() {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = '-20';
            popup.style.color = 'red';
            popup.style.left = '50%';
            popup.style.top = '50%';
            popup.style.transform = 'translate(-50%, -50%)';
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 2500);
        }

        function removeCellG1(cell) {
            const container = cell.parentElement;
            container.classList.add('cell-removing');
            setTimeout(() => { container.style.visibility = 'hidden'; }, 500);
        }

        function showCelebrationG1() {
            finalScoreDisplayG1.textContent = scoreG1;
            celebrationElementG1.style.display = 'flex';
            setTimeout(() => {
                celebrationElementG1.style.display = 'none';
                restartScreenG1.style.display = 'block';
            }, 3000);
        }

        function selectCellG1(cell, index) {
            if (matchedCellsG1.includes(index) || selectedCellsG1.length === 2 || cell.parentElement.classList.contains('cell-removing')) return;
            cell.classList.remove('bg-green-500', 'hover:bg-green-600');
            cell.classList.add('bg-orange-500', 'hover:bg-orange-600');
            selectedCellsG1.push({ cell, index, pairId: cell.dataset.pairId, type: cell.dataset.type });
            if (selectedCellsG1.length === 2) checkMatchG1();
        }

        function checkMatchG1() {
            const [cell1Obj, cell2Obj] = selectedCellsG1;
            if (cell1Obj.type !== cell2Obj.type && cell1Obj.pairId === cell2Obj.pairId) {
                const timeElapsed = (Date.now() - startTimeG1) / 1000;
                const points = Math.max(100 - Math.floor(timeElapsed / 2), 10); 
                scoreG1 += points;
                scoreDisplayG1.textContent = scoreG1;
                showScorePopupG1(cell1Obj.cell, points);
                removeCellG1(cell1Obj.cell);
                removeCellG1(cell2Obj.cell);
                matchedCellsG1.push(cell1Obj.index, cell2Obj.index);
                if (matchedCellsG1.length === gridSizeG1 * gridSizeG1) {
                    clearInterval(timerG1);
                    messageElementG1.textContent = 'æ­å–œï¼ä½ è´äº†ï¼';
                    leaderboardG1.push({ name: playerNameG1, score: scoreG1 });
                    localStorage.setItem('leaderboardG1', JSON.stringify(leaderboardG1));
                    updateLeaderboardG1();
                    showCelebrationG1();
                }
            } else {
                scoreG1 = Math.max(0, scoreG1 - 20);
                scoreDisplayG1.textContent = scoreG1;
                showPenaltyPopupG1();
                cell1Obj.cell.classList.add('shake');
                cell2Obj.cell.classList.add('shake');
                setTimeout(() => {
                    [cell1Obj, cell2Obj].forEach(obj => {
                        obj.cell.classList.remove('bg-orange-500', 'hover:bg-orange-600', 'shake');
                        obj.cell.classList.add('bg-green-500', 'hover:bg-green-600');
                    });
                }, 500);
            }
            selectedCellsG1 = [];
        }

        function startGameG1() {
            startScreenG1.style.display = 'none';
            gridElementG1.style.display = 'grid';
            leaderboardElementG1.style.display = 'block';
            restartScreenG1.style.display = 'none';
            messageElementG1.textContent = '';
            celebrationElementG1.style.display = 'none';
            scoreG1 = 0;
            scoreDisplayG1.textContent = scoreG1;
            matchedCellsG1 = [];
            selectedCellsG1 = [];
            createGridG1();
            startTimeG1 = Date.now();
            timerG1 = setInterval(() => {
                const timeElapsed = (Date.now() - startTimeG1) / 1000;
                messageElementG1.textContent = `æ™‚é–“: ${timeElapsed.toFixed(1)} ç§’`;
            }, 100);
        }
        
        document.getElementById('startButtonG1').addEventListener('click', () => {
            nameInputModalG1.style.display = 'flex';
        });
        document.getElementById('confirmNameG1').addEventListener('click', () => {
            playerNameG1 = document.getElementById('playerNameG1').value.trim();
            if (playerNameG1) {
                nameInputModalG1.style.display = 'none';
                startGameG1();
            } else {
                const nameInput = document.getElementById('playerNameG1');
                nameInput.classList.add('border-red-500');
                nameInput.placeholder = "è«‹è¼¸å…¥æœ‰æ•ˆåç¨±ï¼";
                setTimeout(() => {
                    nameInput.classList.remove('border-red-500');
                    nameInput.placeholder = "ä½ çš„åç¨±";
                }, 2000);
            }
        });
        document.getElementById('restartButtonG1').addEventListener('click', () => nameInputModalG1.style.display = 'flex');
        document.getElementById('clearLeaderboardG1').addEventListener('click', () => {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ’åç´€éŒ„å—ï¼Ÿ')) {
                leaderboardG1 = [];
                localStorage.removeItem('leaderboardG1'); 
                updateLeaderboardG1();
            }
        });
        updateLeaderboardG1();


        // --- Game 2: åŸå­åŠå¾‘å¤§å°è®ŠåŒ– Script ---
        let canvasG2, ctxG2, currentModeG2, paramsG2, layerColorsG2, animationIdG2;
        let game2Initialized = false;

        function initGame2() {
            if (game2Initialized && canvasG2) { 
                 if (animationIdG2) cancelAnimationFrame(animationIdG2);
            }

            canvasG2 = document.getElementById('atomCanvasG2');
            if (!canvasG2) { console.error("Canvas for Game 2 not found"); return; }
            ctxG2 = canvasG2.getContext('2d');
            currentModeG2 = 'group'; 
            
            paramsG2 = {
                layers: 2,
                electrons: 1,
                physics: {
                    baseAtomRadius: 120, 
                    layerSpacingPM: 60,
                    shrinkPerElectronPM: 5, 
                    nucleusBaseFM: 5,
                    nucleusLayerFM: 1.2,
                    nucleusElectronFM: 0.3
                },
                display: {
                    pmToPixel: 0.3, 
                    fmToPixel: 0.1, 
                    chargeFont: 'bold 18px Arial', 
                    layerLabelFont: '12px Arial'
                }
            };

            layerColorsG2 = ['#3B82F6', '#10B981', '#8B5CF6', '#EF4444', '#F59E0B'];

            document.getElementById('layersG2').value = paramsG2.layers;
            document.getElementById('electronsG2').value = paramsG2.electrons;

            document.getElementById('groupBtnG2').classList.add('active-mode');
            document.getElementById('periodBtnG2').classList.remove('active-mode');
            document.getElementById('reasonG2').style.display = 'none';

            drawAtomG2();
            game2Initialized = true;
        }
        
        function calculateAtomRadiusPMG2() {
            if (currentModeG2 === 'group') {
                return paramsG2.physics.baseAtomRadius + (paramsG2.layers - 1) * paramsG2.physics.layerSpacingPM;
            }
            let baseRadiusForLayers = paramsG2.physics.baseAtomRadius + (paramsG2.layers - 1) * paramsG2.physics.layerSpacingPM;
            return baseRadiusForLayers - (paramsG2.electrons - 1) * paramsG2.physics.shrinkPerElectronPM * (paramsG2.layers); 
        }

        function calculateNucleusRadiusFMG2() {
            return paramsG2.physics.nucleusBaseFM + 
                  (paramsG2.layers - 1) * paramsG2.physics.nucleusLayerFM + 
                  (paramsG2.electrons - 1) * paramsG2.physics.nucleusElectronFM;
        }

        function toDisplayPMG2(pm) { return pm * paramsG2.display.pmToPixel; }
        function toDisplayFMG2(fm) { return fm * paramsG2.display.fmToPixel; }

        function handleReasonG2(mode) {
            const reasonDiv = document.getElementById('reasonG2');
            if (currentModeG2 === mode) {
                let reasonText = '';
                if (mode === 'group') {
                    reasonText = `<b>åŒä¸»æ—ï¼ˆæœ€å¤–å±¤é›»å­æ•¸ä¸è®Šï¼Œé›»å­å±¤æ•¸å¢åŠ ï¼‰ï¼š</b><br>
                                1. <b>é›»å­å±¤æ•¸å¢åŠ ï¼š</b>æ¯å¢åŠ ä¸€å€‹é›»å­å±¤ï¼ŒåŸå­é«”ç©é¡¯è‘—å¢å¤§ã€‚<br>
                                2. <b>é®è”½æ•ˆæ‡‰ï¼š</b>å…§å±¤é›»å­å°å¤–å±¤é›»å­çš„æ’æ–¥éƒ¨åˆ†æŠµæ¶ˆäº†æ ¸é›»è·çš„å¸å¼•åŠ›ã€‚<br>
                                3. <b>ä¸»è¦å› ç´ ï¼š</b>é›»å­å±¤æ•¸çš„å¢åŠ æ˜¯ä¸»å°å› ç´ ï¼Œå°è‡´åŸå­åŠå¾‘å¢å¤§ã€‚<br>
                                å› æ­¤ï¼Œåœ¨åŒä¸€ä¸»æ—ä¸­ï¼Œå¾ä¸Šåˆ°ä¸‹ï¼ŒåŸå­åŠå¾‘ä¾æ¬¡å¢å¤§ã€‚`;
                    reasonDiv.className = 'reason-box p-4 rounded-md'; 
                } else { 
                    reasonText = `<b>åŒé€±æœŸï¼ˆé›»å­å±¤æ•¸ä¸è®Šï¼Œæ ¸é›»è·æ•¸åŠæœ€å¤–å±¤é›»å­æ•¸å¢åŠ ï¼‰ï¼š</b><br>
                                1. <b>æ ¸é›»è·æ•¸å¢åŠ ï¼š</b>åŸå­æ ¸ä¸­çš„è³ªå­æ•¸å¢åŠ ï¼Œå°æ ¸å¤–é›»å­çš„å¸å¼•åŠ›å¢å¼·ã€‚<br>
                                2. <b>æœ€å¤–å±¤é›»å­æ•¸å¢åŠ ï¼š</b>é›–ç„¶é›»å­é–“æœ‰æ’æ–¥ï¼Œä½†æ ¸é›»è·å¢åŠ çš„å¸å¼•æ•ˆæ‡‰æ›´å¼·ã€‚<br>
                                3. <b>ä¸»è¦å› ç´ ï¼š</b>æ ¸é›»è·çš„æœ‰æ•ˆå¸å¼•åŠ›å¢åŠ æ˜¯ä¸»å°å› ç´ ï¼Œä½¿é›»å­é›²å‘åŸå­æ ¸æ”¶ç¸®ï¼Œå°è‡´åŸå­åŠå¾‘æ¸›å°ã€‚<br>
                                å› æ­¤ï¼Œåœ¨åŒä¸€é€±æœŸä¸­ï¼Œå¾å·¦åˆ°å³ï¼ˆé™¤ç¨€æœ‰æ°£é«”å¤–ï¼‰ï¼ŒåŸå­åŠå¾‘ä¾æ¬¡æ¸›å°ã€‚`;
                    reasonDiv.className = 'reason-box period-reason p-4 rounded-md'; 
                }
                reasonDiv.innerHTML = reasonText;
                reasonDiv.style.display = reasonDiv.style.display === 'block' ? 'none' : 'block'; 
            } else {
                 reasonDiv.style.display = 'none'; 
            }
        }

        function toggleModeG2(mode) {
            currentModeG2 = mode;
            document.getElementById('groupBtnG2').classList.toggle('active-mode', mode === 'group');
            document.getElementById('periodBtnG2').classList.toggle('active-mode', mode === 'period');
            document.getElementById('reasonG2').style.display = 'none'; 
            
            if (mode === 'group') { 
                document.getElementById('electronsG2').value = 1; 
            } else { 
                 document.getElementById('layersG2').value = Math.min(parseInt(document.getElementById('layersG2').value), 3); 
            }
            updateParamsG2(); 
        }
        
        function drawAtomG2() {
            if (!ctxG2) return;
            const centerX = canvasG2.width / 2;
            const centerY = canvasG2.height / 2;
            ctxG2.clearRect(0, 0, canvasG2.width, canvasG2.height);
            
            const atomRadiusPM = calculateAtomRadiusPMG2();
            const nucleusRadiusFM = calculateNucleusRadiusFMG2();
            
            const displayAtomRadius = Math.max(toDisplayPMG2(atomRadiusPM), 20); 
            const displayNucleus = Math.max(toDisplayFMG2(nucleusRadiusFM), 5); 

            const gradient = ctxG2.createRadialGradient(centerX, centerY, displayNucleus / 3, centerX, centerY, displayNucleus);
            gradient.addColorStop(0, '#FCA5A5'); 
            gradient.addColorStop(1, '#DC2626'); 
            ctxG2.fillStyle = gradient;
            ctxG2.beginPath();
            ctxG2.arc(centerX, centerY, displayNucleus, 0, Math.PI * 2);
            ctxG2.fill();
            ctxG2.fillStyle = 'white';
            ctxG2.font = paramsG2.display.chargeFont;
            ctxG2.textAlign = 'center';
            ctxG2.textBaseline = 'middle';
            ctxG2.fillText('+', centerX, centerY);

            let currentLayerRadius = 0;
            for (let i = 0; i < paramsG2.layers; i++) {
                if (currentModeG2 === 'group') {
                     currentLayerRadius = toDisplayPMG2(paramsG2.physics.baseAtomRadius / paramsG2.layers * (i + 1) + (i * paramsG2.physics.layerSpacingPM / 2));
                } else { 
                    currentLayerRadius = toDisplayPMG2( (paramsG2.physics.baseAtomRadius + i * paramsG2.physics.layerSpacingPM) * (1 - (paramsG2.electrons -1) * paramsG2.physics.shrinkPerElectronPM / (paramsG2.physics.baseAtomRadius * 2) ));
                }
                currentLayerRadius = Math.max(currentLayerRadius, displayNucleus + 10 * (i + 1)); 

                ctxG2.strokeStyle = layerColorsG2[i % layerColorsG2.length];
                ctxG2.lineWidth = 2;
                ctxG2.beginPath();
                ctxG2.arc(centerX, centerY, currentLayerRadius, 0, Math.PI * 2);
                ctxG2.stroke();
                
                ctxG2.fillStyle = layerColorsG2[i % layerColorsG2.length];
                ctxG2.font = paramsG2.display.layerLabelFont;
                ctxG2.fillText(`n=${i+1}`, centerX + currentLayerRadius + 10, centerY - 10);

                if (i === paramsG2.layers - 1) {
                    ctxG2.fillStyle = '#FBBF24'; 
                    const angleStep = (Math.PI * 2) / paramsG2.electrons;
                    for (let j = 0; j < paramsG2.electrons; j++) {
                        const angle = angleStep * j;
                        const x = centerX + Math.cos(angle) * currentLayerRadius;
                        const y = centerY + Math.sin(angle) * currentLayerRadius;
                        ctxG2.beginPath();
                        ctxG2.arc(x, y, 6, 0, Math.PI * 2); 
                        ctxG2.fill();
                        
                        ctxG2.fillStyle = '#4B5563'; 
                        ctxG2.font = paramsG2.display.chargeFont;
                        ctxG2.fillText('-', x, y); 
                    }
                }
            }
            updateInfoG2(atomRadiusPM, nucleusRadiusFM);
        }

        function updateInfoG2(atomRadiusPM, nucleusRadiusFM) {
            let infoText = currentModeG2 === 'group' ?
                `<b>åŒä¸»æ—å…ƒç´ </b> (æœ€å¤–å±¤é›»å­æ•¸: ${paramsG2.electrons})<br>
                 é›»å­å±¤æ•¸ (n): ${paramsG2.layers}<br>` :
                `<b>åŒé€±æœŸå…ƒç´ </b> (é›»å­å±¤æ•¸ n: ${paramsG2.layers})<br>
                 æœ€å¤–å±¤é›»å­æ•¸: ${paramsG2.electrons}<br>`;
            infoText += `ä¼°ç®—åŸå­åŠå¾‘: ${atomRadiusPM.toFixed(1)} pm<br>
                         ä¼°ç®—åŸå­æ ¸åŠå¾‘: ${nucleusRadiusFM.toFixed(1)} fm`;
            document.getElementById('infoG2').innerHTML = infoText;
        }

        function updateParamsG2() {
            paramsG2.layers = parseInt(document.getElementById('layersG2').value);
            paramsG2.electrons = parseInt(document.getElementById('electronsG2').value);
            drawAtomG2();
        }
        
        // --- Game 3: å…ƒç´ é€±æœŸè¡¨é…å° Script ---
        const periodicTableData = [
            // Row 1
            { atomicNumber: 1, symbol: 'H', name_zh: 'æ°«', row: 1, col: 1, fact_zh: 'æ°«æ˜¯å®‡å®™ä¸­æœ€è¼•ã€å«é‡æœ€è±å¯Œçš„å…ƒç´ ï¼Œæ˜¯æ†æ˜Ÿçš„ä¸»è¦ç‡ƒæ–™ã€‚' },
            { atomicNumber: 2, symbol: 'He', name_zh: 'æ°¦', row: 1, col: 18, fact_zh: 'æ°¦æ°£éå¸¸è¼•ä¸”ä¸å¯ç‡ƒï¼Œå¸¸ç”¨æ–¼å¡«å……æ°£çƒå’Œé£›è‰‡ã€‚' },
            // Row 2
            { atomicNumber: 3, symbol: 'Li', name_zh: 'é‹°', row: 2, col: 1, fact_zh: 'é‹°æ˜¯æœ€è¼•çš„é‡‘å±¬ï¼Œå»£æ³›æ‡‰ç”¨æ–¼å……é›»é›»æ± ä¸­ã€‚' },
            { atomicNumber: 4, symbol: 'Be', name_zh: 'éˆ¹', row: 2, col: 2, fact_zh: 'éˆ¹åˆé‡‘å …ç¡¬ä¸”è¼•ï¼Œç”¨æ–¼èˆªç©ºèˆªå¤©å·¥æ¥­ã€‚' },
            { atomicNumber: 5, symbol: 'B', name_zh: 'ç¡¼', row: 2, col: 13, fact_zh: 'ç¡¼ç”¨æ–¼è£½é€ ç»ç’ƒçº–ç¶­å’Œæ¸…æ½”åŠ‘ï¼Œä¹Ÿæ˜¯æ¤ç‰©å¿…éœ€çš„å¾®é‡å…ƒç´ ã€‚' },
            { atomicNumber: 6, symbol: 'C', name_zh: 'ç¢³', row: 2, col: 14, fact_zh: 'ç¢³æ˜¯æ‰€æœ‰ç”Ÿå‘½çš„åŸºç¤ï¼Œèƒ½å½¢æˆå¤šç¨®åŒ–åˆç‰©ï¼Œå¦‚é‘½çŸ³å’ŒçŸ³å¢¨ã€‚' },
            { atomicNumber: 7, symbol: 'N', name_zh: 'æ°®', row: 2, col: 15, fact_zh: 'æ°®æ°£ä½”åœ°çƒå¤§æ°£ç´„78%ï¼Œæ˜¯è›‹ç™½è³ªå’ŒDNAçš„é‡è¦çµ„æˆéƒ¨åˆ†ã€‚' },
            { atomicNumber: 8, symbol: 'O', name_zh: 'æ°§', row: 2, col: 16, fact_zh: 'æ°§æ°£å°å¤§å¤šæ•¸ç”Ÿå‘½è‡³é—œé‡è¦ï¼Œæ”¯æŒå‘¼å¸å’Œç‡ƒç‡’ã€‚' },
            { atomicNumber: 9, symbol: 'F', name_zh: 'æ°Ÿ', row: 2, col: 17, fact_zh: 'æ°Ÿæ˜¯æœ€å…·åæ‡‰æ€§çš„å…ƒç´ ï¼Œç”¨æ–¼ç‰™è†ä¸­ä»¥é˜²æ­¢è›€ç‰™ã€‚' },
            { atomicNumber: 10, symbol: 'Ne', name_zh: 'æ°–', row: 2, col: 18, fact_zh: 'æ°–æ°£åœ¨é€šé›»æ™‚ç™¼å‡ºç´…æ©™è‰²å…‰èŠ’ï¼Œç”¨æ–¼éœ“è™¹ç‡ˆã€‚' },
            // Row 3
            { atomicNumber: 11, symbol: 'Na', name_zh: 'éˆ‰', row: 3, col: 1, fact_zh: 'éˆ‰æ˜¯é£Ÿé¹½çš„ä¸»è¦æˆåˆ†ä¹‹ä¸€ï¼Œå°ç¥ç¶“åŠŸèƒ½å’Œé«”æ¶²å¹³è¡¡å¾ˆé‡è¦ã€‚' },
            { atomicNumber: 12, symbol: 'Mg', name_zh: 'é‚', row: 3, col: 2, fact_zh: 'é‚æ˜¯è‘‰ç¶ ç´ çš„é—œéµæˆåˆ†ï¼Œä¹Ÿç”¨æ–¼è¼•è³ªåˆé‡‘ã€‚' },
            { atomicNumber: 13, symbol: 'Al', name_zh: 'é‹', row: 3, col: 13, fact_zh: 'é‹è¼•å·§ã€è€è…è•ï¼Œå»£æ³›ç”¨æ–¼é£›æ©Ÿã€æ±½è»Šå’ŒåŒ…è£ææ–™ã€‚' },
            { atomicNumber: 14, symbol: 'Si', name_zh: 'çŸ½', row: 3, col: 14, fact_zh: 'çŸ½æ˜¯æ²™å­å’Œç»ç’ƒçš„ä¸»è¦æˆåˆ†ï¼Œä¹Ÿæ˜¯åŠå°é«”å·¥æ¥­çš„åŸºç¤ã€‚' },
            { atomicNumber: 15, symbol: 'P', name_zh: 'ç£·', row: 3, col: 15, fact_zh: 'ç£·æ˜¯éª¨éª¼ã€ç‰™é½’å’ŒDNAçš„å¿…éœ€å…ƒç´ ï¼Œä¹Ÿç”¨æ–¼ç«æŸ´å’Œè‚¥æ–™ã€‚' },
            { atomicNumber: 16, symbol: 'S', name_zh: 'ç¡«', row: 3, col: 16, fact_zh: 'ç¡«å­˜åœ¨æ–¼æŸäº›æ°¨åŸºé…¸ä¸­ï¼Œç”¨æ–¼è£½é€ ç¡«é…¸å’Œç«è—¥ã€‚' },
            { atomicNumber: 17, symbol: 'Cl', name_zh: 'æ°¯', row: 3, col: 17, fact_zh: 'æ°¯å¸¸ç”¨æ–¼æ¶ˆæ¯’é£²ç”¨æ°´å’Œæ¸¸æ³³æ± ï¼Œä¹Ÿæ˜¯é£Ÿé¹½çš„æˆåˆ†ã€‚' },
            { atomicNumber: 18, symbol: 'Ar', name_zh: 'æ°¬', row: 3, col: 18, fact_zh: 'æ°¬æ°£æ˜¯ä¸€ç¨®æƒ°æ€§æ°£é«”ï¼Œç”¨æ–¼ç‡ˆæ³¡å’Œç„Šæ¥ã€‚' },
            // Row 4
            { atomicNumber: 19, symbol: 'K', name_zh: 'é‰€', row: 4, col: 1, fact_zh: 'é‰€å°ç´°èƒåŠŸèƒ½è‡³é—œé‡è¦ï¼Œå­˜åœ¨æ–¼é¦™è•‰ç­‰é£Ÿç‰©ä¸­ã€‚' },
            { atomicNumber: 20, symbol: 'Ca', name_zh: 'éˆ£', row: 4, col: 2, fact_zh: 'éˆ£æ˜¯éª¨éª¼å’Œç‰™é½’çš„ä¸»è¦æˆåˆ†ï¼Œä¹Ÿåƒèˆ‡è‚Œè‚‰æ”¶ç¸®ã€‚' },
            { atomicNumber: 21, symbol: 'Sc', name_zh: 'éˆ§', row: 4, col: 3, fact_zh: 'éˆ§ç”¨æ–¼è£½é€ é«˜æ€§èƒ½åˆé‡‘å’ŒæŸäº›é¡å‹çš„ç…§æ˜è¨­å‚™ã€‚' },
            { atomicNumber: 22, symbol: 'Ti', name_zh: 'éˆ¦', row: 4, col: 4, fact_zh: 'éˆ¦å …å›ºã€è¼•å·§ä¸”è€è…è•ï¼Œç”¨æ–¼é£›æ©Ÿã€äººé€ é—œç¯€å’Œé¡æ–™ã€‚' },
            { atomicNumber: 23, symbol: 'V', name_zh: 'é‡©', row: 4, col: 5, fact_zh: 'é‡©ç”¨æ–¼è£½é€ å …å›ºçš„é‹¼åˆé‡‘ï¼Œå¦‚å·¥å…·é‹¼ã€‚' },
            { atomicNumber: 24, symbol: 'Cr', name_zh: 'é‰»', row: 4, col: 6, fact_zh: 'é‰»ç”¨æ–¼ä¸éŠ¹é‹¼å’Œéé‰»ï¼Œä½¿é‡‘å±¬è¡¨é¢å…‰äº®è€è…è•ã€‚' },
            { atomicNumber: 25, symbol: 'Mn', name_zh: 'éŒ³', row: 4, col: 7, fact_zh: 'éŒ³æ˜¯è£½é€ é‹¼éµçš„é‡è¦å…ƒç´ ï¼Œä¹Ÿåƒèˆ‡ç”Ÿç‰©é«”å…§çš„é…¶åæ‡‰ã€‚' },
            { atomicNumber: 26, symbol: 'Fe', name_zh: 'éµ', row: 4, col: 8, fact_zh: 'éµæ˜¯åœ°æ®¼ä¸­å«é‡è±å¯Œçš„é‡‘å±¬ï¼Œæ˜¯è¡€ç´…è›‹ç™½çš„é—œéµæˆåˆ†ï¼Œç”¨æ–¼é‹è¼¸æ°§æ°£ã€‚' },
            { atomicNumber: 27, symbol: 'Co', name_zh: 'éˆ·', row: 4, col: 9, fact_zh: 'éˆ·ç”¨æ–¼è£½é€ å¼·åŠ›ç£éµå’Œè—è‰²é¡æ–™ï¼Œä¹Ÿæ˜¯ç¶­ç”Ÿç´ B12çš„æˆåˆ†ã€‚' },
            { atomicNumber: 28, symbol: 'Ni', name_zh: 'é³', row: 4, col: 10, fact_zh: 'é³è€è…è•ï¼Œç”¨æ–¼è£½é€ ä¸éŠ¹é‹¼ã€ç¡¬å¹£å’Œé›»æ± ã€‚' },
            { atomicNumber: 29, symbol: 'Cu', name_zh: 'éŠ…', row: 4, col: 11, fact_zh: 'éŠ…å…·æœ‰å„ªè‰¯çš„å°é›»æ€§å’Œå°ç†±æ€§ï¼Œå»£æ³›ç”¨æ–¼é›»ç·šå’Œç®¡é“ã€‚' },
            { atomicNumber: 30, symbol: 'Zn', name_zh: 'é‹…', row: 4, col: 12, fact_zh: 'é‹…ç”¨æ–¼éé‹…ä»¥é˜²æ­¢éµç”Ÿé½ï¼Œä¹Ÿæ˜¯äººé«”å¿…éœ€çš„å¾®é‡å…ƒç´ ã€‚' }
        ];

        const gameGridG3 = document.getElementById('periodic-table-game-grid');
        const currentElementDisplayG3 = document.getElementById('current-element-display');
        const diceButtonG3 = document.getElementById('dice-button');
        const factTextG3 = document.getElementById('fact-text');
        const game3MessageG3 = document.getElementById('game3-message');
        const game3WinMessageG3 = document.getElementById('game3-win-message');
        const restartGame3ButtonG3 = document.getElementById('restart-game3-button');
        const game3ContainerG3 = document.getElementById('game3-container');


        let unplacedElementsG3 = [];
        let currentElementToPlaceG3 = null;
        let placedCountG3 = 0;
        let game3Initialized = false;

        function setupPeriodicTableG3() {
            gameGridG3.innerHTML = ''; 
            for (let r = 1; r <= 4; r++) { 
                for (let c = 1; c <= 18; c++) { 
                    const cell = document.createElement('div');
                    cell.classList.add('pt-cell');
                    cell.dataset.row = r;
                    cell.dataset.col = c;

                    const element = periodicTableData.find(el => el.row === r && el.col === c);
                    if (element) {
                        cell.classList.add('empty-interactive');
                        cell.dataset.atomicNumber = element.atomicNumber;
                        cell.addEventListener('click', handleCellClickG3);
                    } else {
                        cell.classList.add('opacity-50', 'bg-gray-300'); 
                    }
                    gameGridG3.appendChild(cell);
                }
            }
        }
        
        function rollDiceG3() {
            if (unplacedElementsG3.length === 0) {
                currentElementDisplayG3.textContent = "å…¨éƒ¨å®Œæˆï¼";
                diceButtonG3.disabled = true;
                return;
            }
            const randomIndex = Math.floor(Math.random() * unplacedElementsG3.length);
            currentElementToPlaceG3 = unplacedElementsG3[randomIndex];
            currentElementDisplayG3.textContent = `${currentElementToPlaceG3.symbol} (${currentElementToPlaceG3.name_zh})`;
            game3MessageG3.textContent = ''; 
            diceButtonG3.disabled = true; 
        }

        function handleCellClickG3(event) {
            if (!currentElementToPlaceG3) {
                game3MessageG3.textContent = "è«‹å…ˆæ“²éª°å­é¸æ“‡ä¸€å€‹å…ƒç´ ï¼";
                return;
            }

            const clickedCell = event.currentTarget;
            if (clickedCell.classList.contains('filled')) {
                game3MessageG3.textContent = "é€™å€‹ä½ç½®å·²ç¶“å¡«å¥½äº†ï¼";
                return;
            }

            const clickedAtomicNumber = parseInt(clickedCell.dataset.atomicNumber);

            if (clickedAtomicNumber === currentElementToPlaceG3.atomicNumber) {
                clickedCell.innerHTML = `
                    <span class="atomic-number">${currentElementToPlaceG3.atomicNumber}</span>
                    <span class="symbol">${currentElementToPlaceG3.symbol}</span>
                    <span class="name">${currentElementToPlaceG3.name_zh}</span>
                `;
                clickedCell.classList.remove('empty-interactive');
                clickedCell.classList.add('filled');
                clickedCell.style.backgroundColor = getColorForGroupG3(currentElementToPlaceG3.col); 
                
                factTextG3.textContent = currentElementToPlaceG3.fact_zh;
                game3MessageG3.textContent = `æ­£ç¢ºï¼ ${currentElementToPlaceG3.name_zh} æ”¾ç½®æˆåŠŸï¼`;
                game3MessageG3.classList.remove('text-red-600');
                game3MessageG3.classList.add('text-green-600');


                unplacedElementsG3 = unplacedElementsG3.filter(el => el.atomicNumber !== currentElementToPlaceG3.atomicNumber);
                placedCountG3++;
                currentElementToPlaceG3 = null;
                currentElementDisplayG3.textContent = "-";
                diceButtonG3.disabled = false; 

                if (placedCountG3 === periodicTableData.length) {
                    game3WinMessageG3.style.display = 'block';
                    diceButtonG3.disabled = true;
                    currentElementDisplayG3.textContent = "éŠæˆ²å‹åˆ©ï¼";
                }
            } else {
                game3MessageG3.textContent = "éŒ¯èª¤çš„ä½ç½®ï¼è«‹å†è©¦ä¸€æ¬¡ã€‚";
                game3MessageG3.classList.remove('text-green-600');
                game3MessageG3.classList.add('text-red-600');
                
                const gameContentArea = game3ContainerG3.querySelector('.flex.flex-col.items-center');
                if (gameContentArea) {
                    gameContentArea.classList.add('game-board-flash-red');
                    setTimeout(() => {
                        gameContentArea.classList.remove('game-board-flash-red');
                    }, 500);
                }
            }
        }
        
        function getColorForGroupG3(column) {
            if (column === 1) return '#FCA5A5'; 
            if (column === 2) return '#FDBA74'; 
            if (column >= 3 && column <= 12) return '#FDE047'; 
            if (column === 13) return '#A7F3D0'; 
            if (column === 14) return '#93C5FD'; 
            if (column === 15) return '#A5B4FC'; 
            if (column === 16) return '#D8B4FE'; 
            if (column === 17) return '#F9A8D4'; 
            if (column === 18) return '#C4B5FD'; 
            return '#E5E7EB'; 
        }

        function resetGame3() {
            unplacedElementsG3 = [...periodicTableData];
            currentElementToPlaceG3 = null;
            placedCountG3 = 0;
            setupPeriodicTableG3();
            currentElementDisplayG3.textContent = "-";
            factTextG3.textContent = "-";
            game3MessageG3.textContent = "";
            diceButtonG3.disabled = false;
            game3WinMessageG3.style.display = 'none';
        }

        function initGame3() {
            // Ensure IDs in G3 script match HTML
            // e.g. gameGridG3, currentElementDisplayG3 etc.
            resetGame3();
            diceButtonG3.addEventListener('click', rollDiceG3);
            restartGame3ButtonG3.addEventListener('click', resetGame3);
            game3Initialized = true;
        }
        
    </script>
</body>
</html>


